(()=>{function ae(i){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",i):i()}function Qt(i,e){let n=s=>{i.every(h=>!h?.contains(s.target))&&e(s)};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)}function en(i,e,n={}){let s=n.event||"htmx:afterSettle";document.addEventListener(s,a=>{let h=a.detail?.elt;h&&(h.matches?.(i)&&e(h),h.querySelectorAll&&h.querySelectorAll(i).forEach(e))})}function tn(i,e){document.addEventListener("htmx:beforeSwap",n=>{let s=n.detail?.elt;s?.querySelectorAll&&s.querySelectorAll(i).forEach(e)})}function nn(i){let e=document.createElement("div");return e.textContent=i,e.innerHTML}function on(i,e){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>i.apply(this,s),e)}}function sn(i="uid"){return`${i}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}window.Utils={onReady:ae,onClickOutside:Qt,initOnHtmx:en,cleanupOnHtmx:tn,escapeHtml:nn,debounce:on,uniqueId:sn};var rn=/^https?:\/\/.+/i;function Ve(i){let e=i.value.trim(),n=i.type;if(i.hasAttribute("required")&&e==="")return i.dataset.errorRequired||"This field is required";if(e==="")return null;if(i.hasAttribute("maxlength")){let s=parseInt(i.getAttribute("maxlength"),10);if(e.length>s)return i.dataset.errorMaxlength||`Cannot exceed ${s} characters`}return i.hasAttribute("pattern")&&!new RegExp("^"+i.getAttribute("pattern")+"$").test(e)?i.dataset.errorPattern||"Invalid format":n==="url"&&e!==""&&!rn.test(e)?i.dataset.errorUrl||"Must be a valid URL":null}function Rt(i,e){i.classList.add("input-error"),i.classList.remove("input-valid");let n=i.parentElement.querySelector(".field-error");n||(n=document.createElement("p"),n.className="field-error",i.parentElement.appendChild(n)),n.textContent=e,n.style.display="block"}function pt(i,e=!1){i.classList.remove("input-error"),e&&i.value.trim()!==""?i.classList.add("input-valid"):i.classList.remove("input-valid");let n=i.parentElement.querySelector(".field-error");n&&(n.style.display="none")}function Ht(i){let e=!0;if(i.querySelectorAll("input, textarea, select").forEach(s=>{if(s.type==="hidden"||s.type==="submit"||s.type==="button")return;let a=Ve(s);a?(Rt(s,a),e=!1):pt(s)}),!e){let s=i.querySelector(".input-error");s&&(s.scrollIntoView({behavior:"smooth",block:"center"}),s.focus())}return e}function gt(i){i.addEventListener("blur",function(e){let n=e.target;if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"){let s=Ve(n);s?Rt(n,s):pt(n,!0)}},!0),i.addEventListener("input",function(e){let n=e.target;n.classList.contains("input-error")&&(Ve(n)||pt(n,!0))},!0),i.addEventListener("submit",function(e){Ht(i)||(e.preventDefault(),e.stopPropagation())})}function _t(){document.querySelectorAll("form[data-validate]").forEach(gt)}ae(_t);document.addEventListener("htmx:afterSwap",function(i){i.detail&&i.detail.target&&i.detail.target.querySelectorAll("form[data-validate]").forEach(gt)});window.FormValidation={init:_t,initForm:gt,validateForm:Ht,validateField:Ve};var vt=new Set,Le=null;function Bt(i){return!(typeof i!="string"||vt.has(i)||!i.startsWith("/")||i.startsWith("/static/")||i.startsWith("/admin")||i.endsWith(".xml")||i.includes("#")||i===window.location.pathname)}function je(i,e){if(!Bt(i))return;vt.add(i);let n=document.createElement("link");n.rel="prefetch",n.href=i,n.as="document",document.head.appendChild(n)}function an(i){let e=i.closest("a[href]");return e?e.getAttribute("href"):null}function cn(){typeof IntersectionObserver>"u"||(Le&&Le.disconnect(),Le=new IntersectionObserver(function(i){i.forEach(function(e){if(e.isIntersecting){let n=e.target.getAttribute("href");je(n,"viewport"),Le.unobserve(e.target)}})},{rootMargin:"100px"}),bt())}function bt(){Le&&document.querySelectorAll('a[href^="/"]').forEach(function(i){let e=i.getAttribute("href");Bt(e)&&Le.observe(i)})}function ln(){document.addEventListener("touchstart",function(i){let e=an(i.target);e&&je(e,"touch")},{passive:!0})}function dn(){document.addEventListener("mouseenter",function(i){if(i.target.tagName==="A"){let e=i.target.getAttribute("href");je(e,"hover")}},{capture:!0,passive:!0})}function un(){cn(),ln(),dn()}function fn(){document.body.addEventListener("htmx:afterSettle",function(){setTimeout(bt,100)})}ae(function(){un(),fn()});window.prefetchDebug={prefetched:vt,prefetch:je,observeLinks:bt};var fe=null,$t=null,Je=!1,He=0,_e={minimum:.1,trickleSpeed:200,trickleAmount:.02,speed:200,easing:"ease-out"};function hn(){return fe||(fe=document.createElement("div"),fe.className="progress-bar",fe.innerHTML='<div class="progress-bar-inner"></div>',document.body.appendChild(fe),fe)}function Be(i){i=Math.max(0,Math.min(1,i)),He=i;let e=fe.querySelector(".progress-bar-inner");e&&(e.style.transform="translateX("+(-100+i*100)+"%)")}function mn(){if(He>=1)return;let i=_e.trickleAmount;He>.5&&(i=.01),He>.8&&(i=.005),Be(He+Math.random()*i)}function yt(){Je||(Je=!0,hn(),Be(_e.minimum),fe.classList.add("active"),$t=setInterval(mn,_e.trickleSpeed))}function Xe(){Je&&(clearInterval($t),Be(1),setTimeout(function(){fe.classList.remove("active"),Je=!1,setTimeout(function(){Be(0)},_e.speed)},_e.speed))}function pn(){document.body.addEventListener("htmx:beforeRequest",function(i){(i.detail.boosted||i.detail.elt.hasAttribute("hx-indicator"))&&yt()}),document.body.addEventListener("htmx:afterSettle",function(){Xe()}),document.body.addEventListener("htmx:responseError",function(){Xe()}),document.body.addEventListener("htmx:sendError",function(){Xe()})}window.addEventListener("beforeunload",function(){yt()});ae(pn);window.progressBar={start:yt,done:Xe,set:Be};var ve=class{constructor(e){this.tableBodyId=e.tableBodyId,this.searchId=e.searchId,this.filters=e.filters||[],this.searchFields=e.searchFields||[],this.storageKey=e.storageKey,this.tableCardSelector=e.tableCardSelector,this._initialized=!1}init(){if(this._initialized)return;this._initialized=!0,this.restore();let e=document.getElementById(this.searchId);e&&e.addEventListener("input",()=>this.apply()),this.filters.forEach(n=>{let s=document.getElementById(n.id);s&&s.addEventListener("change",()=>this.apply())}),this.apply()}apply(){let e=document.getElementById(this.searchId)?.value.toLowerCase()||"",n=document.querySelectorAll(`#${this.tableBodyId} tr`),s=0,a={};return this.filters.forEach(h=>{a[h.id]=document.getElementById(h.id)?.value||""}),n.forEach(h=>{let g=!0;e&&(this.searchFields.some(x=>(h.dataset[x]?.toLowerCase()||"").includes(e))||(g=!1)),g&&this.filters.forEach(p=>{let x=a[p.id];x&&(p.match?p.match(h,x)||(g=!1):(h.dataset[p.dataAttr]||"")!==x&&(g=!1))}),h.style.display=g?"":"none",g&&s++}),this._updateVisibility(s,n.length),this.save(),s}clear(){let e=document.getElementById(this.searchId);e&&(e.value=""),window.dropdowns&&this.filters.forEach(n=>{let s=window.dropdowns.get(n.id);s&&s.reset("")}),this.storageKey&&sessionStorage.removeItem(this.storageKey),this.apply()}save(){if(!this.storageKey)return;let e={search:document.getElementById(this.searchId)?.value||""};this.filters.forEach(n=>{e[n.id]=document.getElementById(n.id)?.value||""}),sessionStorage.setItem(this.storageKey,JSON.stringify(e))}restore(){if(!this.storageKey)return;let e=sessionStorage.getItem(this.storageKey);if(e)try{let n=JSON.parse(e),s=document.getElementById(this.searchId);s&&n.search&&(s.value=n.search),setTimeout(()=>{window.dropdowns&&this.filters.forEach(a=>{let h=n[a.id];if(h){let g=window.dropdowns.get(a.id);g&&g.reset(h)}}),this.apply()},10)}catch(n){console.warn("Failed to restore filter state:",n)}}_updateVisibility(e,n){let s=document.getElementById("no-results"),a=this.tableCardSelector?document.querySelector(this.tableCardSelector):null;e===0&&n>0?(s?.classList.remove("hidden"),a?.classList.add("hidden")):(s?.classList.add("hidden"),a?.classList.remove("hidden"))}};ve.booleanMatcher=function(i,e){return function(n,s){let a=n.dataset[i];return e&&e[s]!==void 0?a===String(e[s]):a===s}};ve.publicPrivateMatcher=function(i,e){let n=i.dataset.isPublic==="true";return e==="public"?n:e==="private"?!n:!0};ve.draftPublishedMatcher=function(i,e){let n=i.dataset.isDraft==="true";return e==="published"?!n:e==="draft"?n:!0};ve.bookmarkStatusMatcher=function(i,e){let n=i.dataset.isPublic==="true",s=i.dataset.isFavorite==="true";return e==="public"?n:e==="private"?!n:e==="favorite"?s:!0};ve.collectionMatcher=function(i,e){let n=i.dataset.collectionId||"";return e==="none"?n==="":n===e};window.TableFilter=ve;var R={EXPAND_BTN_CLASS:"expand-btn",ROTATE_CLASS:"rotate-90",HIDDEN_CLASS:"hidden",EXPANDED_ATTR:"data-expanded",ID_ATTR:"data-expandable-id",TYPE_ATTR:"data-expandable-type",LOADED_ATTR:"data-loaded",FETCH_TRIGGER:"fetchContent"},Pt=new Set;function Ze(i,e){let n=document.getElementById(`${i}-content-${e}`);n&&!n.hasAttribute(R.LOADED_ATTR)&&(n.setAttribute(R.LOADED_ATTR,"true"),typeof htmx<"u"&&htmx.trigger(n,R.FETCH_TRIGGER))}function Nt(i,e){let n=document.querySelector(`[${R.ID_ATTR}="${e}"][${R.TYPE_ATTR}="${i}"]`),s=document.getElementById(`${i}-details-${e}`);if(!n||!s){console.warn(`[ExpandableRow] Missing elements for ${i}-${e}`);return}let a=n.querySelector(`.${R.EXPAND_BTN_CLASS}`);n.getAttribute(R.EXPANDED_ATTR)==="true"?(n.setAttribute(R.EXPANDED_ATTR,"false"),n.setAttribute("aria-expanded","false"),s.classList.add(R.HIDDEN_CLASS),a&&a.classList.remove(R.ROTATE_CLASS)):(Ze(i,e),n.setAttribute(R.EXPANDED_ATTR,"true"),n.setAttribute("aria-expanded","true"),s.classList.remove(R.HIDDEN_CLASS),a&&a.classList.add(R.ROTATE_CLASS))}function gn(i,e,n){(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),Nt(e,n))}function Ft(i,e,n){let s=`${e}-${n}`;Pt.has(s)||i.getAttribute("role")==="button"&&(i.addEventListener("mouseenter",function(){Ze(e,n)},{once:!0}),i.addEventListener("focus",function(){Ze(e,n)},{once:!0}),Pt.add(s))}function Ut(i){document.querySelectorAll(`[${R.TYPE_ATTR}="${i}"]`).forEach(n=>{let s=n.getAttribute(R.ID_ATTR);s&&Ft(n,i,s)})}function zt(){let i=document.querySelectorAll(`[${R.TYPE_ATTR}]`),e=new Set;i.forEach(n=>{let s=n.getAttribute(R.TYPE_ATTR);s&&e.add(s)}),e.forEach(n=>Ut(n))}ae(zt);document.addEventListener("htmx:afterSettle",function(i){i.detail?.elt&&(i.detail.elt.querySelectorAll?.(`[${R.TYPE_ATTR}]`)||[]).forEach(n=>{let s=n.getAttribute(R.TYPE_ATTR),a=n.getAttribute(R.ID_ATTR);s&&a&&Ft(n,s,a)})});window.ExpandableRow={toggle:Nt,prefetch:Ze,handleKeydown:gn,init:zt,initType:Ut};var Qe=class{constructor(e,n={}){this.container=e,this.gap=n.gap||16,this.minColumnWidthDesktop=n.minColumnWidth||300,this.minColumnWidthMobile=n.minColumnWidthMobile||280,this.columnHeights=[],this.resizeTimeout=null,this.layoutTimeout=null,this.itemHeights=new Map,this.init()}get minColumnWidth(){return window.innerWidth<640?this.minColumnWidthMobile:this.minColumnWidthDesktop}init(){this.container.style.position="relative",this._resizeHandler=()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>this.layout(),150)},window.addEventListener("resize",this._resizeHandler),this.resizeObserver=new ResizeObserver(n=>{let s=!1;for(let a of n){let h=a.target,g=this.itemHeights.get(h)||0,p=h.offsetHeight;Math.abs(p-g)>5&&(s=!0,this.itemHeights.set(h,p))}s&&(clearTimeout(this.layoutTimeout),this.layoutTimeout=setTimeout(()=>this.layout(),100))}),this.container.querySelectorAll(".masonry-item").forEach(n=>{n.setAttribute("data-laid-out","true"),this.resizeObserver.observe(n)}),this.layout()}getColumnCount(){let e=this.container.offsetWidth;return Math.max(1,Math.floor((e+this.gap)/(this.minColumnWidth+this.gap)))}getColumnWidth(){let e=this.getColumnCount();return(this.container.offsetWidth-(e-1)*this.gap)/e}layout(){let e=[...this.container.querySelectorAll(".masonry-item")],n=this.getColumnCount(),s=this.getColumnWidth();this.columnHeights=Array(n).fill(0),e.forEach(a=>{this.positionItem(a,s),this.itemHeights.set(a,a.offsetHeight)}),this.updateContainerHeight()}positionItem(e,n){let s=Math.min(...this.columnHeights),a=this.columnHeights.indexOf(s);e.style.position="absolute",e.style.width=`${n}px`,e.style.left=`${a*(n+this.gap)}px`,e.style.top=`${s}px`,this.columnHeights[a]+=e.offsetHeight+this.gap}append(e){let n=this.getColumnWidth();e.forEach(s=>{s.setAttribute("data-laid-out","true"),this.positionItem(s,n),this.itemHeights.set(s,s.offsetHeight),this.resizeObserver.observe(s)}),this.updateContainerHeight()}updateContainerHeight(){let e=Math.max(...this.columnHeights,0);this.container.style.height=`${e}px`}destroy(){this.resizeObserver.disconnect(),clearTimeout(this.resizeTimeout),clearTimeout(this.layoutTimeout),this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null)}};window.SimpleMasonry=Qe;function Wt(){let i=document.getElementById("bookmark-grid");if(i){if(window.bookmarkMasonry){if(window.bookmarkMasonry.container===i)return;window.bookmarkMasonry.destroy(),window.bookmarkMasonry=null}window.bookmarkMasonry=new Qe(i,{gap:16,minColumnWidth:350,minColumnWidthMobile:280})}}ae(function(){Wt(),document.body.addEventListener("htmx:oobAfterSwap",function(i){if(i.detail.target.id!=="bookmark-grid"||!window.bookmarkMasonry)return;let n=[...document.getElementById("bookmark-grid").querySelectorAll(".masonry-item:not([data-laid-out])")];n.length!==0&&window.bookmarkMasonry.append(n)}),document.body.addEventListener("htmx:afterSettle",function(i){document.getElementById("bookmark-grid")&&(window.bookmarkMasonry&&(window.bookmarkMasonry.destroy(),window.bookmarkMasonry=null),Wt())})});(function(){"use strict";let i={edgeThreshold:60,maxScrollSpeed:15,minScrollSpeed:3},e={maxSelection:50};function n(){return{isDragging:!1,draggedCard:null,draggedCards:[],sourceColumn:null,sourceIndex:null,sourcePositions:[],placeholder:null,isMultiDrag:!1}}function s(){return{animationId:null,horizontalSpeed:0,verticalSpeed:0,boardContainer:null,columnContainer:null}}function a(){return{isActive:!1,card:null,originalColumn:null,originalNextSibling:null,originalIndex:null}}function h(){return{selectedIds:new Set,lastSelectedId:null,columnId:null}}function g(){return{isOpen:!1,focusedIndex:0,collections:[],previousFocus:null}}let p=n(),x=s(),b=a(),m=h(),L=g();function O(){Object.assign(p,n())}function H(){Object.assign(x,s())}function P(){Object.assign(b,a())}function ce(){Object.assign(m,h())}function J(){Object.assign(L,g())}function z(t){typeof window.showToast=="function"?window.showToast(t,"error"):alert(t)}function Z(t,o,r){return t===1?o:r||o+"s"}function V(t,o,r="item"){A(`${t} ${Z(t,r)} ${o}`)}function Q(t){return document.querySelector(`.kanban-card[data-bookmark-id="${t}"]`)}function le(t){return t.closest(".kanban-column-content")}function se(t){return Array.from(t.querySelectorAll(".kanban-card"))}function W(){let o=document.body.getAttribute("hx-headers");if(o)try{let c=JSON.parse(o);if(c["X-CSRF-Token"])return c["X-CSRF-Token"]}catch{}let r=document.cookie.split(";");for(let c of r){let[f,u]=c.trim().split("=");if(f==="csrf_token")return u}return""}function he(t,o,r={}){let{afterBookmarkId:c=null,onSuccess:f=null,onError:u=null}=r,E=W(),k={bookmark_ids:t,collection_id:o===""?null:parseInt(o,10)};return c&&(k.after_id=parseInt(c,10)),fetch("/admin/htmx/bookmarks/bulk/move",{method:"POST",headers:{"X-CSRF-Token":E,"Content-Type":"application/json"},body:JSON.stringify(k)}).then(I=>{if(!I.ok)throw new Error(`Failed to move bookmarks: ${I.status}`);return f&&f(),I}).catch(I=>{throw console.error("[Kanban] Error moving bookmarks:",I),u&&u(I),z("Failed to move bookmarks. Please try again."),I})}function A(t){let o=document.getElementById("kanban-live-region");o&&(o.textContent="",requestAnimationFrame(()=>{o.textContent=t}))}function j(t){let o=t.closest(".kanban-column");return o&&o.dataset.collectionId||null}function N(t){return t.dataset.bookmarkId}function me(t){return m.selectedIds.has(N(t))}function X(t){me(t)?(t.classList.add("selected"),t.setAttribute("aria-selected","true")):(t.classList.remove("selected"),t.setAttribute("aria-selected","false"))}function _(){m.selectedIds.forEach(t=>{let o=Q(t);o&&(o.classList.remove("selected"),o.setAttribute("aria-selected","false"))}),m.selectedIds=new Set,m.lastSelectedId=null,m.columnId=null,w()}function de(t,o={}){let{toggle:r=!1,addToSelection:c=!1}=o,f=N(t),u=j(t);m.columnId!==null&&m.columnId!==u&&m.selectedIds.size>0&&_(),r?m.selectedIds.has(f)?(m.selectedIds.delete(f),m.selectedIds.size===0&&(m.columnId=null,m.lastSelectedId=null)):m.selectedIds.size<e.maxSelection&&(m.selectedIds.add(f),m.lastSelectedId=f,m.columnId=u):c?m.selectedIds.size<e.maxSelection&&(m.selectedIds.add(f),m.columnId=u):(_(),m.selectedIds.add(f),m.lastSelectedId=f,m.columnId=u),X(t),w()}function Ce(t){let o=j(t);if(!m.lastSelectedId||m.columnId!==o){de(t);return}let r=t.closest(".kanban-column-content"),c=Array.from(r.querySelectorAll(".kanban-card")),f=N(t),u=c.findIndex(M=>N(M)===m.lastSelectedId),E=c.findIndex(M=>N(M)===f);if(u===-1||E===-1){de(t);return}let k=Math.min(u,E),I=Math.max(u,E);for(let M=k;M<=I&&m.selectedIds.size<e.maxSelection;M++){let U=c[M];m.selectedIds.add(N(U)),X(U)}m.columnId=o,w();let q=m.selectedIds.size;A(`${q} item${q!==1?"s":""} selected`)}function we(t,o){let r=t.closest(".kanban-column-content"),c=j(t),f=Array.from(r.querySelectorAll(".kanban-card")),E=f.indexOf(t)+o;if(E<0||E>=f.length){A(o<0?"At top of column":"At bottom of column");return}let k=f[E],I=N(k);if(m.columnId!==null&&m.columnId!==c&&_(),m.selectedIds.has(N(t))||(m.selectedIds.add(N(t)),m.lastSelectedId=N(t),m.columnId=c,X(t)),m.selectedIds.has(I)){let M=N(t);m.selectedIds.delete(M),X(t)}else m.selectedIds.size<e.maxSelection&&(m.selectedIds.add(I),X(k));m.lastSelectedId=I,w(),k.focus(),Y(k);let q=m.selectedIds.size;A(`${q} item${q!==1?"s":""} selected`)}function Ie(t){let o=t.closest(".kanban-column-content"),r=j(t),c=Array.from(o.querySelectorAll(".kanban-card"));_();let f=Math.min(c.length,e.maxSelection);for(let E=0;E<f;E++)m.selectedIds.add(N(c[E])),X(c[E]);m.columnId=r,c.length>0&&(m.lastSelectedId=N(c[f-1])),w();let u=m.selectedIds.size;A(`${u} item${u!==1?"s":""} selected`)}function Te(){let t=[];return m.selectedIds.forEach(o=>{let r=Q(o);r&&t.push(r)}),t}function y(){return Array.from(m.selectedIds).map(t=>parseInt(t,10))}function w(){let t=document.getElementById("kanban-selection-toolbar");if(!t)return;let o=m.selectedIds.size;if(o===0)t.classList.add("hidden");else{t.classList.remove("hidden");let r=t.querySelector(".selection-count");r&&(r.textContent=`${o} selected`)}}function T(t){let o=t.target.closest(".kanban-card");if(!o||t.target.closest("button, a, [data-dropdown-trigger], [data-dropdown-option]")||b.isActive)return;let c=navigator.platform.toUpperCase().indexOf("MAC")>=0?t.metaKey:t.ctrlKey;t.shiftKey?(t.preventDefault(),Ce(o)):c?(t.preventDefault(),de(o,{toggle:!0})):de(o)}function C(t){!t.target.closest(".kanban-card")&&!t.target.closest("#kanban-selection-toolbar")&&!t.target.closest("#kanban-move-menu")&&_()}function ee(){if(m.selectedIds.size<2)return;L.previousFocus=document.activeElement;let t=[],o=m.columnId;t.push({id:"",name:"Unsorted",color:null,isCurrent:o===null||o===""}),document.querySelectorAll("[data-selection-move-menu] [data-move-collection-id]").forEach(u=>{let E=u.dataset.moveCollectionId;if(E!==""){let k=u.querySelector(".selection-move-option-color");t.push({id:E,name:u.querySelector("span:last-child")?.textContent.trim()||"Collection",color:k?k.style.backgroundColor:null,isCurrent:E===o})}}),L.collections=t,L.focusedIndex=t.findIndex(u=>!u.isCurrent),L.focusedIndex===-1&&(L.focusedIndex=0),te();let r=document.getElementById("kanban-move-menu"),c=document.getElementById("kanban-move-menu-backdrop");r&&(r.classList.remove("hidden"),L.isOpen=!0,r.focus()),c&&c.classList.remove("hidden");let f=document.getElementById("move-menu-count");f&&(f.textContent=m.selectedIds.size),A(`Move menu opened. ${t.length} options. Use arrow keys to navigate.`)}function K(){let t=document.getElementById("kanban-move-menu"),o=document.getElementById("kanban-move-menu-backdrop");t&&t.classList.add("hidden"),o&&o.classList.add("hidden"),L.isOpen=!1,L.previousFocus&&L.previousFocus.focus&&L.previousFocus.focus(),L.previousFocus=null}function te(){let t=document.querySelector(".kanban-move-menu-list");t&&(t.innerHTML=L.collections.map((o,r)=>{let c=r===L.focusedIndex,f=r<9?r+1:null;return`
          <div class="kanban-move-menu-item ${o.isCurrent?"current":""} ${c?"focused":""}"
               role="option"
               data-index="${r}"
               data-collection-id="${o.id}"
               aria-selected="${c}"
               ${o.isCurrent?'aria-disabled="true"':""}>
            ${o.color?`<span class="kanban-move-menu-item-color" style="background-color: ${o.color}"></span>`:'<svg class="kanban-move-menu-item-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg>'}
            <span class="kanban-move-menu-item-name">${o.name}</span>
            ${f?`<span class="kanban-move-menu-item-shortcut">${f}</span>`:""}
          </div>
        `}).join(""),t.querySelectorAll(".kanban-move-menu-item:not(.current)").forEach(o=>{o.addEventListener("click",()=>{let r=parseInt(o.dataset.index,10);L.focusedIndex=r,Ae()})}))}function Pe(t){let{collections:o,focusedIndex:r}=L,c=r,f=0;do c=c+t,c<0&&(c=o.length-1),c>=o.length&&(c=0),f++;while(o[c].isCurrent&&f<o.length);L.focusedIndex=c,rt();let u=o[c];A(`${u.name}${u.isCurrent?" (current)":""}`)}function rt(){let t=document.querySelector(".kanban-move-menu-list");if(!t)return;t.querySelectorAll(".kanban-move-menu-item").forEach((r,c)=>{let f=c===L.focusedIndex;r.classList.toggle("focused",f),r.setAttribute("aria-selected",f)});let o=t.querySelector(".kanban-move-menu-item.focused");o&&o.scrollIntoView({block:"nearest"})}function Ae(){let t=L.collections[L.focusedIndex];!t||t.isCurrent||(K(),Dt(t.id))}function it(t){let o=t-1;if(o<0||o>=L.collections.length)return;let r=L.collections[o];if(r.isCurrent){A(`${r.name} is the current column`);return}L.focusedIndex=o,Ae()}function at(t){if(L.isOpen)switch(t.key){case"ArrowUp":t.preventDefault(),Pe(-1);break;case"ArrowDown":t.preventDefault(),Pe(1);break;case"Enter":t.preventDefault(),Ae();break;case"Escape":t.preventDefault(),K(),A("Move menu closed");break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.preventDefault(),it(parseInt(t.key,10));break;case"Tab":t.preventDefault();break}}function ct(){L.isOpen&&(K(),A("Move menu closed"))}function De(t){let o=t.querySelector(".kanban-column-title h3");return o?o.textContent.trim():"Unknown"}function be(t){let o=t.closest(".kanban-column-content"),r=Array.from(o.querySelectorAll(".kanban-card"));return{index:r.indexOf(t)+1,total:r.length}}function Ne(t){return t.getAttribute("aria-label")||"Bookmark"}function ke(t){let o=t.closest(".kanban-column-content");return Array.from(o.querySelectorAll(".kanban-card")).indexOf(t)}function pe(t){let{edgeThreshold:o,maxScrollSpeed:r,minScrollSpeed:c}=i;if(t>=o)return 0;let f=1-t/o;return c+(r-c)*f}function ye(t,o){let r=document.getElementById("kanban-board");if(!r)return;let c=r.getBoundingClientRect(),{edgeThreshold:f}=i,u=0,E=t-c.left,k=c.right-t;E<f&&r.scrollLeft>0?u=-pe(E):k<f&&r.scrollLeft<r.scrollWidth-r.clientWidth&&(u=pe(k));let I=0,q=null,M=document.elementFromPoint(t,o)?.closest(".kanban-column-content");if(M){let U=M.getBoundingClientRect(),ie=o-U.top,F=U.bottom-o;ie<f&&M.scrollTop>0?(I=-pe(ie),q=M):F<f&&M.scrollTop<M.scrollHeight-M.clientHeight&&(I=pe(F),q=M)}x.horizontalSpeed=u,x.verticalSpeed=I,x.boardContainer=r,x.columnContainer=q,u!==0||I!==0?Fe():Se()}function Fe(){if(x.animationId!==null)return;function t(){let{horizontalSpeed:o,verticalSpeed:r,boardContainer:c,columnContainer:f}=x;c&&o!==0&&(c.scrollLeft+=o),f&&r!==0&&(f.scrollTop+=r),p.isDragging&&(o!==0||r!==0)?x.animationId=requestAnimationFrame(t):x.animationId=null}x.animationId=requestAnimationFrame(t)}function Se(){x.animationId!==null&&(cancelAnimationFrame(x.animationId),x.animationId=null),x.horizontalSpeed=0,x.verticalSpeed=0,x.boardContainer=null,x.columnContainer=null}function lt(){let t=document.createElement("div");return t.className="kanban-drop-placeholder",t.setAttribute("aria-hidden","true"),t}function Ue(){p.placeholder&&p.placeholder.parentNode&&p.placeholder.remove()}function Me(){document.querySelectorAll(".drag-over").forEach(t=>{t.classList.remove("drag-over")})}function dt(t,o){let r=Array.from(t.querySelectorAll(".kanban-card:not(.dragging)"));for(let c of r){let f=c.getBoundingClientRect(),u=f.top+f.height/2;if(o<u)return c}return null}function ze(t,o){let{placeholder:r}=p;if(!r)return;let c=t.querySelector(".kanban-empty");c&&c.remove(),o?o.parentNode.insertBefore(r,o):t.appendChild(r)}function We(t){let o=t.target.closest(".kanban-card");if(!o)return;let r=o.dataset.bookmarkId,c=m.selectedIds.has(r),f=m.selectedIds.size>1;if(c||_(),p.isDragging=!0,p.draggedCard=o,p.sourceColumn=o.closest(".kanban-column-content"),p.sourceIndex=ke(o),c&&f){p.isMultiDrag=!0;let u=o.closest(".kanban-column-content"),E=Array.from(u.querySelectorAll(".kanban-card"));p.draggedCards=E.filter(k=>m.selectedIds.has(k.dataset.bookmarkId)),p.sourcePositions=p.draggedCards.map(k=>({card:k,column:k.closest(".kanban-column-content"),nextSibling:k.nextElementSibling})),setTimeout(()=>{p.draggedCards.forEach((k,I)=>{k.classList.add("dragging"),k!==o&&k.classList.add("multi-drag-secondary")}),ut(o,p.draggedCards.length)},0)}else p.isMultiDrag=!1,p.draggedCards=[o],p.sourcePositions=[{card:o,column:o.closest(".kanban-column-content"),nextSibling:o.nextElementSibling}],setTimeout(()=>{o.classList.add("dragging")},0);t.dataTransfer.setData("text/plain",r),t.dataTransfer.effectAllowed="move",p.placeholder=lt()}function ut(t,o){qe();let r=document.createElement("div");r.className="multi-drag-badge",r.textContent=o,r.id="multi-drag-badge",t.style.position="relative",t.appendChild(r)}function qe(){let t=document.getElementById("multi-drag-badge");t&&t.remove()}function Ke(t){t.target.closest(".kanban-card")&&(p.draggedCards.forEach(r=>{r.classList.remove("dragging"),r.classList.remove("multi-drag-secondary")}),qe(),Ue(),Me(),Se(),O())}function xe(t){t.preventDefault(),t.dataTransfer.dropEffect="move",p.isDragging&&ye(t.clientX,t.clientY);let o=t.target.closest(".kanban-column-content");if(!o||!p.isDragging)return;let r=dt(o,t.clientY);ze(o,r)}function Ge(t){let o=t.target.closest(".kanban-column-content");!o||!p.isDragging||o.classList.add("drag-over")}function d(t){let o=t.target.closest(".kanban-column-content");if(!o)return;let r=t.relatedTarget;o.contains(r)||o.classList.remove("drag-over")}function l(t){t.preventDefault(),Se();let o=t.target.closest(".kanban-column-content");if(!o||!p.draggedCard)return;let{draggedCard:r,draggedCards:c,sourceColumn:f,sourceIndex:u,placeholder:E,isMultiDrag:k}=p,I=E?E.nextElementSibling:null;if(Ue(),Me(),k&&c.length>1){c.forEach(F=>{F.classList.remove("dragging"),F.classList.remove("multi-drag-secondary")}),qe(),c.forEach(F=>{I?o.insertBefore(F,I):o.appendChild(F)});let q=c[0],M=ht(q),U=o.dataset.collectionId||"";if(o!==f||c.some((F,Re)=>ke(F)!==u+Re)){let F=c.map(Re=>parseInt(Re.dataset.bookmarkId,10));v(F,U,M,c,f)}_()}else{r.classList.remove("dragging"),I?o.insertBefore(r,I):o.appendChild(r);let q=ht(r),M=ke(r);if(o!==f||M!==u){let ie=r.dataset.bookmarkId,F=o.dataset.collectionId||"";Tt(ie,F,q,r,f,u)}}Ee()}function v(t,o,r){he(t,o,{afterBookmarkId:r,onSuccess:()=>{V(t.length,"moved","bookmark")},onError:()=>{S()}})}function S(){p.sourcePositions.forEach(({card:t,column:o,nextSibling:r})=>{r&&r.parentNode===o?o.insertBefore(t,r):o.appendChild(t)}),Ee()}function D(t){let o=t.closest(".kanban-column-content");b.isActive=!0,b.card=t,b.originalColumn=o,b.originalNextSibling=t.nextElementSibling,b.originalIndex=Array.from(o.querySelectorAll(".kanban-card")).indexOf(t),t.classList.add("keyboard-dragging"),t.setAttribute("aria-grabbed","true"),o.classList.add("keyboard-drop-target");let r=Ne(t);A(`Grabbed ${r}. Use arrow keys to move, Enter or Space to drop, Escape to cancel.`)}function B(t=!1){if(!b.isActive)return;let{card:o,originalColumn:r,originalNextSibling:c}=b,f=o.closest(".kanban-column-content"),u=Ne(o);if(t)c?r.insertBefore(o,c):r.appendChild(o),A(`Move cancelled. ${u} returned to original position.`);else{let E=De(f.closest(".kanban-column")),k=be(o),I=ke(o);if(f!==r||I!==b.originalIndex){let M=o.dataset.bookmarkId,U=f.dataset.collectionId||"",ie=ht(o);Tt(M,U,ie,o,r,b.originalIndex)}A(`${u} dropped in ${E} at position ${k.index} of ${k.total}.`)}o.classList.remove("keyboard-dragging"),o.setAttribute("aria-grabbed","false"),document.querySelectorAll(".keyboard-drop-target").forEach(E=>{E.classList.remove("keyboard-drop-target")}),Ee(),P(),o.focus()}function $(t){let o=t.previousElementSibling;if(o&&o.classList.contains("kanban-card")){t.parentNode.insertBefore(t,o);let r=be(t);A(`Moved to position ${r.index} of ${r.total}`),t.focus()}else A("Already at top of column")}function G(t){let o=t.nextElementSibling;if(o&&o.classList.contains("kanban-card")){t.parentNode.insertBefore(o,t);let r=be(t);A(`Moved to position ${r.index} of ${r.total}`),t.focus()}else A("Already at bottom of column")}function re(t,o){let r=t.closest(".kanban-column"),c=Array.from(document.querySelectorAll(".kanban-column:not(.kanban-new-column)")),u=c.indexOf(r)+o;if(u<0||u>=c.length){A(o<0?"Already in first column":"Already in last column");return}let E=c[u],k=E.querySelector(".kanban-column-content"),I=r.querySelector(".kanban-column-content"),M=Array.from(I.querySelectorAll(".kanban-card")).indexOf(t),U=k.querySelector(".kanban-empty");U&&U.remove();let ie=Array.from(k.querySelectorAll(".kanban-card")),F=Math.min(M,ie.length);F<ie.length?k.insertBefore(t,ie[F]):k.appendChild(t),I.classList.remove("keyboard-drop-target"),k.classList.add("keyboard-drop-target");let Re=De(E),Ot=be(t);A(`Moved to ${Re}, position ${Ot.index} of ${Ot.total}`),t.focus()}function ne(t){let o=le(t),r=o.querySelector(".kanban-card");r&&r!==t&&(o.insertBefore(t,r),oe(t,"Moved to top"),Y(t))}function ue(t){le(t).appendChild(t),oe(t,"Moved to bottom"),Y(t)}function oe(t,o){let r=be(t);A(`${o}, position ${r.index} of ${r.total}`)}function Y(t){if(!t)return;t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"});let o=t.closest(".kanban-column");if(o){let r=document.getElementById("kanban-board");if(r){let c=o.getBoundingClientRect(),f=r.getBoundingClientRect();c.left<f.left?r.scrollLeft-=f.left-c.left+20:c.right>f.right&&(r.scrollLeft+=c.right-f.right+20)}}}function ft(){return Array.from(document.querySelectorAll(".kanban-column:not(.kanban-new-column)"))}function Oe(t){let o=t.querySelector(".kanban-column-content");return o?Array.from(o.querySelectorAll(".kanban-card")):[]}function St(t,o){let r=t.closest(".kanban-column"),c=Oe(r),u=c.indexOf(t)+o;if(u>=0&&u<c.length){let E=c[u];return E.focus(),Y(E),!0}return!1}function xt(t,o){let r=ft(),c=t.closest(".kanban-column"),u=r.indexOf(c)+o;if(u<0||u>=r.length)return!1;let E=r[u],k=Oe(c),I=Oe(E);if(I.length===0)return!1;let q=k.indexOf(t),M=Math.min(q,I.length-1),U=I[M];return U.focus(),Y(U),!0}function Lt(){let t=ft();for(let o of t){let r=Oe(o);if(r.length>0)return r[0].focus(),Y(r[0]),!0}return!1}function Ct(){let t=ft();for(let o=t.length-1;o>=0;o--){let r=Oe(t[o]);if(r.length>0){let c=r[r.length-1];return c.focus(),Y(c),!0}}return!1}function Kt(t){let o=t.querySelector('[hx-get*="/edit-drawer"]');o&&o.click()}function Gt(t){let o=t.querySelector('a[target="_blank"]');o&&window.open(o.href,"_blank","noopener,noreferrer")}function Yt(t){let o=t.querySelector("[hx-delete]");o&&o.click()}function Vt(){let t=document.getElementById("kanban-help-modal");if(!t)return;if(t.classList.contains("hidden")){t.classList.remove("hidden");let r=t.querySelector("[data-close-modal]");r&&r.focus()}else{t.classList.add("hidden");let r=document.querySelector(".kanban-card");r&&r.focus()}}function Ye(){let t=document.getElementById("kanban-help-modal");if(t&&!t.classList.contains("hidden")){t.classList.add("hidden");let o=document.querySelector(".kanban-card");o&&o.focus()}}function It(t){let o=t.target.closest(".kanban-card");if(!o)return;let r=t.target===o,c=t.target.closest(".kanban-card-drag-handle"),f=!r&&!c,u=b.isActive&&b.card===o,E=t.metaKey||t.ctrlKey,k=m.selectedIds.size>1;switch(t.key){case" ":case"Enter":if(f)return;t.preventDefault(),u?B(!1):D(o);break;case"ArrowUp":t.preventDefault(),E?u?ne(o):Lt():t.shiftKey&&!u?we(o,-1):u?($(o),Y(o)):St(o,-1);break;case"ArrowDown":t.preventDefault(),E?u?ue(o):Ct():t.shiftKey&&!u?we(o,1):u?(G(o),Y(o)):St(o,1);break;case"ArrowLeft":t.preventDefault(),u?re(o,-1):xt(o,-1),u&&Y(o);break;case"ArrowRight":t.preventDefault(),u?re(o,1):xt(o,1),u&&Y(o);break;case"Home":t.preventDefault(),u&&E?ne(o):u||Lt();break;case"End":t.preventDefault(),u&&E?ue(o):u||Ct();break;case"Escape":u?(t.preventDefault(),B(!0)):m.selectedIds.size>0&&(t.preventDefault(),_(),A("Selection cleared"));break;case"a":case"A":E&&!u&&r&&(t.preventDefault(),Ie(o));break;case"e":case"E":!u&&r&&(t.preventDefault(),Kt(o));break;case"o":case"O":!u&&r&&(t.preventDefault(),Gt(o));break;case"Delete":case"Backspace":!u&&r&&(t.preventDefault(),k?At():Yt(o));break;case"m":case"M":!u&&k&&(t.preventDefault(),ee());break}}function ht(t){let o=t.previousElementSibling;return o&&o.classList.contains("kanban-card")&&o.dataset.bookmarkId||""}function Tt(t,o,r,c,f,u){let E=`/admin/htmx/bookmarks/${t}/collection`,k=W(),I=`collection_id=${encodeURIComponent(o)}`;r&&(I+=`&after_id=${encodeURIComponent(r)}`),fetch(E,{method:"POST",headers:{"X-CSRF-Token":k,"Content-Type":"application/x-www-form-urlencoded"},body:I}).then(q=>{if(!q.ok)throw new Error(`Failed to move bookmark: ${q.status}`);Ee(),Xt(c)}).catch(q=>{console.error("[Kanban] Error moving bookmark:",q),jt(c,f,u),Ee(),z("Failed to move bookmark. Please try again.")})}function jt(t,o,r){let c=Array.from(o.querySelectorAll(".kanban-card"));r>=c.length?o.appendChild(t):o.insertBefore(t,c[r])}function Ee(){document.querySelectorAll(".kanban-column").forEach(o=>{let r=o.querySelector(".kanban-column-content"),c=o.querySelector(".kanban-column-count");if(r&&c){let f=r.querySelectorAll(".kanban-card");c.textContent=f.length.toString();let u=r.querySelector(".kanban-empty");if(f.length===0&&!u){let E=o.dataset.unsorted==="true",k=document.createElement("div");k.className="kanban-empty",k.innerHTML=`<p class="kanban-empty-text">${E?"No unsorted bookmarks":"Drop bookmarks here"}</p>`,r.appendChild(k)}else f.length>0&&u&&u.remove()}})}function Xt(t){t.classList.add("bg-green-50"),setTimeout(()=>{t.classList.remove("bg-green-50")},500)}function At(){let t=m.selectedIds.size;if(t===0||!confirm(`Are you sure you want to delete ${t} ${Z(t,"bookmark")}?`))return;let r=y(),c=W();fetch("/admin/htmx/bookmarks/bulk/delete",{method:"DELETE",headers:{"X-CSRF-Token":c,"Content-Type":"application/json"},body:JSON.stringify({bookmark_ids:r})}).then(f=>{if(!f.ok)throw new Error(`Failed to delete bookmarks: ${f.status}`);r.forEach(u=>{let E=Q(u);E&&E.remove()}),_(),Ee(),V(t,"deleted","bookmark")}).catch(f=>{console.error("[Kanban] Error deleting bookmarks:",f),z("Failed to delete bookmarks. Please try again.")})}function Dt(t){let o=m.selectedIds.size;if(o===0)return;let r=y();he(r,t,{onSuccess:()=>{let c=t===""?document.querySelector('.kanban-column[data-unsorted="true"] .kanban-column-content'):document.querySelector(`.kanban-column[data-collection-id="${t}"] .kanban-column-content`);if(c){let f=c.querySelector(".kanban-empty");f&&f.remove(),r.forEach(u=>{let E=Q(u);E&&c.appendChild(E)})}_(),Ee(),V(o,"moved","bookmark")}})}function Mt(t){if(L.isOpen){at(t);return}if(t.key==="?"&&!t.target.closest("input, textarea, select")){t.preventDefault(),Vt();return}if(t.key==="Escape"){let o=document.getElementById("kanban-help-modal");if(o&&!o.classList.contains("hidden")){t.preventDefault(),Ye();return}}}function mt(){let t=document.getElementById("kanban-board");if(!t)return;t.addEventListener("dragstart",We),t.addEventListener("dragend",Ke),t.addEventListener("dragover",xe),t.addEventListener("dragenter",Ge),t.addEventListener("dragleave",d),t.addEventListener("drop",l),t.addEventListener("keydown",It),t.addEventListener("click",T),document.addEventListener("click",C),document.addEventListener("keydown",Mt);let o=document.getElementById("kanban-help-modal");if(o){o.addEventListener("click",f=>{f.target===o&&Ye()});let c=o.querySelector("[data-close-modal]");c&&c.addEventListener("click",Ye)}Jt();let r=document.getElementById("kanban-move-menu-backdrop");r&&r.addEventListener("click",ct),document.body.addEventListener("htmx:afterSwap",Zt)}function Jt(){let t=document.getElementById("kanban-selection-toolbar");if(!t)return;let o=t.querySelector(".clear-selection");o&&o.addEventListener("click",_);let r=t.querySelector(".delete-selected");r&&r.addEventListener("click",At);let c=t.querySelector("[data-selection-move-dropdown]");if(c){let f=c.querySelector("[data-selection-move-trigger]"),u=c.querySelector("[data-selection-move-menu]");f&&u&&(f.addEventListener("click",E=>{E.stopPropagation(),u.classList.contains("open")?(u.classList.remove("open"),f.setAttribute("aria-expanded","false")):(u.classList.add("open"),f.setAttribute("aria-expanded","true"))}),u.querySelectorAll("[data-move-collection-id]").forEach(E=>{E.addEventListener("click",()=>{let k=E.dataset.moveCollectionId;Dt(k),u.classList.remove("open"),f.setAttribute("aria-expanded","false")})}),document.addEventListener("click",E=>{c.contains(E.target)||(u.classList.remove("open"),f.setAttribute("aria-expanded","false"))}))}}function Zt(t){(t.detail.target.id==="kanban-board"||t.detail.target.id==="bookmarks-content")&&(qt(),mt())}function qt(){let t=document.getElementById("kanban-board");t&&(t.removeEventListener("dragstart",We),t.removeEventListener("dragend",Ke),t.removeEventListener("dragover",xe),t.removeEventListener("dragenter",Ge),t.removeEventListener("dragleave",d),t.removeEventListener("drop",l),t.removeEventListener("keydown",It),t.removeEventListener("click",T)),document.removeEventListener("keydown",Mt),document.removeEventListener("click",C),Ye(),_(),b.isActive&&B(!0),Se(),Ue(),Me(),p.isDragging=!1,p.draggedCard=null,p.sourceColumn=null,p.sourceIndex=null,p.placeholder=null}window.kanban={init:mt,cleanup:qt,announce:A},document.addEventListener("DOMContentLoaded",mt)})();var et=class i extends HTMLElement{static CONFIG={DISMISS_DELAY:3e3,EXIT_ANIMATION_DURATION:200,RETRY_TIMEOUT:1e4};static ICONS={error:'<span class="toast-icon" aria-hidden="true">&#x2717;</span>',success:'<span class="toast-icon" aria-hidden="true">&#x2713;</span>',warning:'<span class="toast-icon" aria-hidden="true">&#x26A0;</span>',info:'<span class="toast-icon" aria-hidden="true">&#x2139;</span>'};#e=null;#i=new WeakMap;connectedCallback(){this.setAttribute("role","status"),this.setAttribute("aria-live","polite"),this.setAttribute("aria-label","Notifications"),this.#e=new AbortController,this.#a(this.#e.signal),window.Toast=this}disconnectedCallback(){this.#e?.abort(),window.Toast===this&&(window.Toast=null)}show(e,n="error"){let s=document.createElement("div");s.className=`toast toast-${n}`,s.setAttribute("role","alert"),s.setAttribute("aria-live","polite");let a=i.ICONS[n]||i.ICONS.error;return s.innerHTML=`${a} ${this.#o(e)}`,s.addEventListener("click",()=>this.dismiss(s)),this.appendChild(s),setTimeout(()=>this.dismiss(s),i.CONFIG.DISMISS_DELAY),s}dismiss(e){!e||e.classList.contains("toast-exit")||(e.classList.add("toast-exit"),setTimeout(()=>{e.parentNode&&e.remove()},i.CONFIG.EXIT_ANIMATION_DURATION))}error(e){return this.show(e,"error")}success(e){return this.show(e,"success")}warning(e){return this.show(e,"warning")}info(e){return this.show(e,"info")}#o(e){let n=document.createElement("div");return n.textContent=e,n.innerHTML}#r(){return`
      <div class="flex items-center justify-center py-4 text-muted-foreground">
        <svg class="animate-spin" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
        </svg>
      </div>
    `}#t(e,n){return`
      <div class="flex items-center justify-center gap-2 py-4 text-sm text-destructive" data-inline-error>
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" x2="12" y1="8" y2="12"></line>
          <line x1="12" x2="12.01" y1="16" y2="16"></line>
        </svg>
        <span>${this.#o(e)}</span>
        <button type="button" class="btn-ghost btn-sm" data-retry-url="${this.#o(n)}">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
            <path d="M21 3v5h-5"></path>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
            <path d="M8 16H3v5"></path>
          </svg>
        </button>
      </div>
    `}#n(e){let n=e.closest("[data-inline-error]");if(n){let a=n.closest('[hx-get][hx-swap="innerHTML"]');if(a)return a}let s=e.getAttribute("hx-swap");return s&&s.includes("innerHTML")?e:null}#a(e){document.body.addEventListener("htmx:beforeRequest",n=>{let s=n.detail.elt,a=s.getAttribute("hx-swap"),h=s.getAttribute("hx-get");if(a&&a.includes("innerHTML")&&h){let g=setTimeout(()=>{n.detail.xhr&&n.detail.xhr.abort(),s.innerHTML=this.#t("Request timed out",h)},i.CONFIG.RETRY_TIMEOUT);this.#i.set(s,g)}},{signal:e}),document.body.addEventListener("htmx:afterRequest",n=>{let s=n.detail.elt,a=this.#i.get(s);a&&(clearTimeout(a),this.#i.delete(s))},{signal:e}),document.body.addEventListener("htmx:responseError",n=>{let a=n.detail.elt.getAttribute("hx-swap");a&&a.includes("innerHTML")||this.show("Failed to save","error")},{signal:e}),document.body.addEventListener("htmx:sendError",n=>{let s=n.detail.elt,a=this.#n(s),h=s.getAttribute("hx-get")||s.getAttribute("data-retry-url");a&&h?a.innerHTML=this.#t("Connection error",h):this.show("Connection error","error")},{signal:e}),document.body.addEventListener("click",n=>{let s=n.target.closest("[data-retry-url]");if(!s)return;let a=s.getAttribute("data-retry-url"),h=s.closest('[hx-get][hx-swap="innerHTML"]');if(h&&a){h.innerHTML=this.#r();let g=setTimeout(()=>{h.innerHTML=this.#t("Request timed out",a)},i.CONFIG.RETRY_TIMEOUT);htmx.ajax("GET",a,{target:h,swap:"innerHTML"}).then(()=>{clearTimeout(g)}).catch(()=>{clearTimeout(g),h.innerHTML=this.#t("Connection error",a)})}},{signal:e})}};customElements.define("ec-toast-container",et);window.EcToastContainer=et;var ge={DEFAULT_MAX_HEIGHT:240,MIN_HEIGHT:100,VIEWPORT_MARGIN:4,TRIGGER_GAP:2,Z_INDEX:100},tt=new Map,$e=class extends HTMLElement{#e=null;#i=null;#o=!1;#r=null;#t=null;#n=null;#a=null;#c=[];#s=null;#l=null;connectedCallback(){if(this.#r=this.querySelector("[data-trigger]"),this.#t=this.querySelector("[data-menu]"),this.#n=this.querySelector('input[type="hidden"]'),this.#a=this.querySelector("[data-label]"),this.#c=[...this.querySelectorAll("[data-option]")],this.#s=document.getElementById("dropdown-portal"),!this.#r||!this.#t){console.warn("ec-dropdown: Missing [data-trigger] or [data-menu]",this);return}this.#e=new AbortController;let{signal:e}=this.#e;this.#d(),this.#h(e),this.#f();let n=this.#n?.id;n&&tt.set(n,this)}disconnectedCallback(){this.#e?.abort(),this.#i?.abort(),this.#m(),this.#o&&(this.#o=!1);let e=this.#n?.id;e&&tt.delete(e)}#d(){let e=this.#n?.id||`dropdown-${Date.now()}`,n=`${e}-listbox`;this.#r.setAttribute("aria-haspopup","listbox"),this.#r.setAttribute("aria-controls",n),this.#r.setAttribute("aria-expanded","false"),this.#t.setAttribute("role","listbox"),this.#t.setAttribute("id",n),this.#t.setAttribute("tabindex","-1"),this.#c.forEach((a,h)=>{let g=`${e}-option-${h}`;a.setAttribute("role","option"),a.setAttribute("id",g);let p=a.getAttribute("data-selected")==="true";a.setAttribute("aria-selected",p?"true":"false")});let s=this.#c.find(a=>a.getAttribute("data-selected")==="true");s&&this.#r.setAttribute("aria-activedescendant",s.id)}#h(e){this.#r.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),this.toggle()},{signal:e}),this.#c.forEach(n=>{n.addEventListener("click",s=>{let a=n.hasAttribute("hx-post")||n.hasAttribute("hx-get")||n.hasAttribute("hx-put")||n.hasAttribute("hx-delete")||n.hasAttribute("hx-patch");a||s.preventDefault(),this.select(n,a)},{signal:e})}),this.addEventListener("keydown",n=>this.#p(n),{signal:e}),this.#t.addEventListener("keydown",n=>this.#p(n),{signal:e}),document.addEventListener("click",n=>{this.#o&&!this.contains(n.target)&&!this.#t.contains(n.target)&&this.close()},{signal:e})}#f(){let e=this.#c.some(n=>n.hasAttribute("hx-post")||n.hasAttribute("hx-get")||n.hasAttribute("hx-put")||n.hasAttribute("hx-delete")||n.hasAttribute("hx-patch"));this.#s&&this.#t&&!e&&(this.#l=this.#t.parentElement,this.#t.remove(),this.#s.appendChild(this.#t))}#m(){this.#t&&this.#t.parentElement===this.#s&&this.#l&&(this.#t.remove(),this.#l.appendChild(this.#t))}toggle(){this.#o?this.close():this.open()}open(){tt.forEach(e=>{e!==this&&e.isOpen&&e.close()}),this.#o=!0,this.#t.style.display="block",this.#u(),this.#r.setAttribute("aria-expanded","true"),this.#i=new AbortController,window.addEventListener("scroll",e=>{this.#t.contains(e.target)||this.close()},{capture:!0,passive:!0,signal:this.#i.signal})}close(){this.#o&&(this.#o=!1,this.#t.style.display="none",this.#r.setAttribute("aria-expanded","false"),this.#i?.abort(),this.#i=null)}select(e,n=!1){if(n){this.close();return}let s=e.dataset.value,a=e.textContent.trim();this.#a&&(this.#a.textContent=a),this.#n&&(this.#n.value=s,this.#n.dispatchEvent(new Event("change",{bubbles:!0}))),this.#c.forEach(h=>{h.removeAttribute("data-selected"),h.setAttribute("aria-selected","false")}),e.setAttribute("data-selected","true"),e.setAttribute("aria-selected","true"),this.#r.setAttribute("aria-activedescendant",e.id),this.close()}reset(e=""){let n=this.#c.find(s=>s.dataset.value===e);n&&(this.#a&&(this.#a.textContent=n.textContent.trim()),this.#c.forEach(s=>{s.removeAttribute("data-selected"),s.setAttribute("aria-selected","false")}),n.setAttribute("data-selected","true"),n.setAttribute("aria-selected","true"),this.#r.setAttribute("aria-activedescendant",n.id),this.#n&&(this.#n.value=e))}get isOpen(){return this.#o}get value(){return this.#n?.value??""}set value(e){this.reset(e)}#u(){let e=this.#r.getBoundingClientRect(),s=window.innerHeight-e.bottom-ge.VIEWPORT_MARGIN,a=e.top-ge.VIEWPORT_MARGIN,h=parseInt(getComputedStyle(this.#t).minWidth)||0,g=Math.max(e.width,h);if(this.#t.style.width=`${g}px`,this.#t.style.left=`${e.left}px`,s<ge.DEFAULT_MAX_HEIGHT&&a>s){let p=Math.max(ge.MIN_HEIGHT,Math.min(ge.DEFAULT_MAX_HEIGHT,a));this.#t.style.maxHeight=`${p}px`,this.#t.style.top=`${e.top-Math.min(this.#t.scrollHeight,p)-ge.TRIGGER_GAP}px`}else{let p=Math.max(ge.MIN_HEIGHT,Math.min(ge.DEFAULT_MAX_HEIGHT,s));this.#t.style.maxHeight=`${p}px`,this.#t.style.top=`${e.bottom+ge.TRIGGER_GAP}px`}}#p(e){switch(e.key){case"Escape":this.close(),this.#r.focus();break;case"Enter":if(!this.#o)e.preventDefault(),this.open();else{let n=this.#t.querySelector("[data-option]:focus");n&&(e.preventDefault(),this.select(n))}break;case"ArrowDown":case"ArrowUp":this.#o&&(e.preventDefault(),this.#g(e.key==="ArrowDown"?1:-1));break}}#g(e){let n=this.#c,s=n.findIndex(g=>g===document.activeElement||g.getAttribute("data-selected")==="true"),a;e===1?a=s<n.length-1?s+1:0:a=s>0?s-1:n.length-1;let h=n[a];h&&(h.focus(),this.#r.setAttribute("aria-activedescendant",h.id))}};customElements.define("ec-dropdown",$e);window.EcDropdown=$e;window.dropdowns=tt;window.Dropdown=$e;window.initDropdown=i=>i.tagName==="EC-DROPDOWN"?i:(console.warn("initDropdown() called on non-ec-dropdown element. Migrate to <ec-dropdown>."),null);var nt=class i extends HTMLElement{static FOCUSABLE_SELECTOR='button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])';static ANIMATION_DURATION=200;#e=!1;#i=null;#o=null;#r=null;#t=null;#n=null;#a=null;#c=null;#s=null;#l=null;connectedCallback(){if(this.#n=this.querySelector("[data-backdrop]"),this.#a=this.querySelector("[data-panel]"),this.#c=this.querySelector("[data-title]"),this.#s=this.querySelector("[data-content]"),this.#l=this.querySelector("[data-close]"),!this.#n||!this.#a){console.warn("ec-drawer: Missing [data-backdrop] or [data-panel]",this);return}this.#r=new AbortController,this.#d(this.#r.signal),window.drawerOpen=this.open.bind(this),window.drawerClose=this.close.bind(this),window.drawerIsDirty=this.isDirty.bind(this),window.drawerIsOpen=()=>this.#e}disconnectedCallback(){this.#r?.abort(),this.#t?.abort(),window.drawerOpen===this.open.bind(this)&&(window.drawerOpen=null,window.drawerClose=null,window.drawerIsDirty=null,window.drawerIsOpen=null)}open(e,n){document.body&&(!this.#n||!this.#a||(this.#c&&e&&(this.#c.textContent=e),n&&this.#s&&(this.#s.innerHTML='<div class="p-6 flex items-center justify-center"><span class="animate-spin">&#8635;</span></div>',htmx.ajax("GET",n,{target:this.#s,swap:"innerHTML"})),this.#n.classList.add("open"),this.#a.classList.add("open"),this.#e=!0,document.body.style.overflow="hidden",this.#o=document.activeElement,this.#h(),this.#a.focus()))}close(e=!1){return this.#e?!e&&this.isDirty()&&!confirm("You have unsaved changes. Are you sure you want to close?")?!1:(!this.#n||!this.#a||(this.#n.classList.remove("open"),this.#a.classList.remove("open"),this.#e=!1,document.body.style.overflow="",this.#f(),this.#o&&typeof this.#o.focus=="function"&&this.#o.focus(),this.#o=null,setTimeout(()=>{this.#s&&(this.#s.innerHTML=""),this.#i=null},i.ANIMATION_DURATION)),!0):!0}isDirty(){if(!this.#s||!this.#i)return!1;let e=this.#s.querySelector("form");if(!e)return!1;let n=this.#u(e);return this.#i!==n}get isOpen(){return this.#e}#d(e){this.#n?.addEventListener("click",()=>this.close(),{signal:e}),this.#l?.addEventListener("click",()=>this.close(),{signal:e}),document.addEventListener("keydown",n=>{n.key==="Escape"&&this.#e&&this.close()},{signal:e}),document.addEventListener("htmx:afterSwap",n=>{n.detail.target===this.#s&&setTimeout(()=>{if(this.#m(),this.#e&&this.#a){let s=this.#a.querySelector(i.FOCUSABLE_SELECTOR);s&&s.focus()}},50)},{signal:e}),document.addEventListener("closeDrawer",()=>this.close(!0),{signal:e})}#h(){this.#t=new AbortController;let{signal:e}=this.#t;document.addEventListener("keydown",n=>{if(n.key!=="Tab"||!this.#e)return;let s=this.#a.querySelectorAll(i.FOCUSABLE_SELECTOR);if(s.length===0)return;let a=s[0],h=s[s.length-1];n.shiftKey?(document.activeElement===a||document.activeElement===this.#a)&&(n.preventDefault(),h.focus()):document.activeElement===h&&(n.preventDefault(),a.focus())},{signal:e})}#f(){this.#t?.abort(),this.#t=null}#m(){if(!this.#s)return;let e=this.#s.querySelector("form");e&&(this.#i=this.#u(e))}#u(e){let n=new FormData(e),s=[];for(let[a,h]of n.entries())a!=="csrf_token"&&s.push(`${a}=${h}`);return s.sort().join("&")}};customElements.define("ec-drawer",nt);window.EcDrawer=nt;var Et=class i extends HTMLElement{static CREATE_TAG_ENDPOINT="/admin/tags/create-inline";static DEFAULT_PLACEHOLDER="Select tags...";#e=!1;#i=null;#o=null;#r=null;#t=null;#n=null;#a=null;#c=null;#s=null;#l=null;#d=null;connectedCallback(){if(this.#o=this.querySelector("[data-trigger]"),this.#r=this.querySelector("[data-dropdown]"),this.#t=this.querySelector("[data-filter]"),this.#n=this.querySelector("[data-options]"),this.#a=this.querySelector("[data-chips]"),this.#c=this.querySelector("[data-placeholder]"),this.#s=this.querySelector("[data-create]"),this.#l=this.querySelector("[data-create-btn]"),this.#d=this.querySelector("[data-create-name]"),!this.#o||!this.#r){console.warn("ec-tag-select: Missing [data-trigger] or [data-dropdown]",this);return}this.#i=new AbortController,this.#h(this.#i.signal)}disconnectedCallback(){this.#i?.abort()}get fieldName(){return this.getAttribute("field-name")||"tag_ids"}#h(e){this.#o.addEventListener("click",n=>{n.target.closest("[data-remove]")||this.#f()},{signal:e}),this.#a&&this.#a.addEventListener("click",n=>{let s=n.target.closest("[data-remove]");s&&(n.stopPropagation(),this.#p(s.dataset.remove))},{signal:e}),this.#t&&(this.#t.addEventListener("input",n=>this.#m(n.target.value),{signal:e}),this.#t.addEventListener("click",n=>n.stopPropagation(),{signal:e})),this.#n&&this.#n.addEventListener("change",n=>{n.target.matches('input[type="checkbox"]')&&this.#u()},{signal:e}),this.#l&&this.#l.addEventListener("click",n=>{n.stopPropagation();let s=this.#d?.textContent?.trim();s&&this.#g(s)},{signal:e}),document.addEventListener("click",n=>{this.#e&&!this.contains(n.target)&&this.#f(!1)},{signal:e}),this.addEventListener("keydown",n=>{if(n.key==="Escape"&&this.#e&&(this.#f(!1),this.#o.focus()),n.key==="Enter"&&this.#t===document.activeElement&&(n.preventDefault(),this.#s&&!this.#s.classList.contains("hidden"))){let s=this.#d?.textContent?.trim();s&&this.#g(s)}},{signal:e})}#f(e){this.#e=e!==void 0?e:!this.#e,this.#r.classList.toggle("hidden",!this.#e),this.#e&&this.#t&&(this.#t.focus(),this.#t.value="",this.#m(""))}#m(e){if(!this.#n)return;let n=e.toLowerCase().trim(),s=this.#n.querySelectorAll("[data-option]"),a=!1;s.forEach(h=>{let g=h.dataset.name?.toLowerCase()||"",p=n===""||g.includes(n);h.hidden=!p,g===n&&(a=!0)}),this.#s&&this.#d&&(n&&!a?(this.#s.classList.remove("hidden"),this.#d.textContent=e.trim()):this.#s.classList.add("hidden"))}#u(){if(!this.#a||!this.#n)return;let e=this.#n.querySelectorAll('input[type="checkbox"]:checked');this.#a.innerHTML="",e.forEach(n=>{let a=n.closest("[data-option]")?.dataset.name||"",h=n.dataset.id,g=document.createElement("span");g.className="tag-chip",g.dataset.tagId=h,g.innerHTML=`
        ${this.#b(a)}
        <button type="button" class="tag-chip-remove" data-remove="${h}" aria-label="Remove ${this.#b(a)}">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      `,this.#a.appendChild(g)}),this.#c&&(this.#c.textContent=e.length===0?i.DEFAULT_PLACEHOLDER:"")}#p(e){if(!this.#n)return;let n=this.#n.querySelector(`input[data-id="${e}"]`);n&&(n.checked=!1,this.#u())}async#g(e){let n=this.#v(e);try{let s=await fetch(i.CREATE_TAG_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":this.#y()},body:`name=${encodeURIComponent(e)}&slug=${encodeURIComponent(n)}`});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);let a=await s.json();if(this.#n){let h=document.createElement("label");h.className="tag-select-option",h.dataset.option="",h.dataset.name=a.name,h.innerHTML=`
          <input type="checkbox" name="${this.fieldName}" value="${a.id}" 
                 data-id="${a.id}" checked />
          <span>${this.#b(a.name)}</span>
        `,this.#n.appendChild(h)}this.#u(),this.#t&&(this.#t.value=""),this.#s&&this.#s.classList.add("hidden"),this.#m("")}catch(s){console.error("Failed to create tag:",s),typeof window.showToast=="function"&&window.showToast("Failed to create tag. Please try again.","error")}}#v(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}#b(e){let n=document.createElement("div");return n.textContent=e,n.innerHTML}#y(){let e=document.body?.getAttribute("hx-headers");if(e)try{let s=JSON.parse(e);if(s["X-CSRF-Token"])return s["X-CSRF-Token"]}catch{}return document.querySelector('input[name="csrf_token"]')?.value||""}};customElements.define("ec-tag-select",Et);var wt=class i extends HTMLElement{static SCROLL_THRESHOLD=10;static SCROLL_TOP_ZONE=50;#e=!1;#i=!1;#o=0;#r=!1;#t=null;#n=null;#a=null;#c=null;#s=null;#l=null;connectedCallback(){if(this.#n=this.querySelector(".nav-drawer"),this.#a=this.querySelector(".nav-drawer-backdrop"),this.#c=this.querySelector(".mobile-bottom-bar"),this.#s=this.querySelector(".nav-loading-indicator"),!this.#n){console.warn("ec-mobile-nav: Missing .nav-drawer",this);return}this.#l=this.#d(),this.#t=new AbortController,this.#h(this.#t.signal),window.navDrawer={open:this.open.bind(this),close:this.close.bind(this),toggle:this.toggle.bind(this),isOpen:()=>this.#e}}disconnectedCallback(){this.#t?.abort(),this.#e&&(document.body.classList.remove("nav-drawer-open"),document.body.style.overflow=""),window.navDrawer?.open===this.open.bind(this)&&(window.navDrawer=null)}#d(){let e=document.querySelector(".main-content-scroll");return e&&e.scrollHeight>e.clientHeight?e:window}#h(e){let n=this.#c?.querySelector("[data-toggle]");n&&n.addEventListener("click",()=>this.toggle(),{signal:e}),this.#a&&this.#a.addEventListener("click",()=>this.close(),{signal:e}),document.addEventListener("keydown",a=>this.#f(a),{signal:e}),this.#n.querySelectorAll('a[href^="/"]').forEach(a=>{a.addEventListener("click",h=>this.#m(h),{signal:e})}),this.#l===window?window.addEventListener("scroll",a=>this.#p(a),{passive:!0,signal:e}):this.#l&&this.#l.addEventListener("scroll",a=>this.#p(a),{passive:!0,signal:e}),document.addEventListener("htmx:afterSettle",()=>{this.#E(),this.#e&&this.close(),this.#o=0,this.#v(),this.#l=this.#d()},{signal:e})}#f(e){e.key==="Escape"&&this.#e&&this.close()}#m(e){this.#y(),this.close()}#u=()=>{this.#e&&this.close()};#p(e){this.#e||this.#r||(requestAnimationFrame(()=>{this.#g(e),this.#r=!1}),this.#r=!0)}#g(e){let n;e.target===document||e.target===window||!e.target.scrollTop?n=window.scrollY||window.pageYOffset:n=e.target.scrollTop;let s=n-this.#o;Math.abs(s)<i.SCROLL_THRESHOLD||(n<i.SCROLL_TOP_ZONE?this.#v():s>0?this.#b():this.#v(),this.#o=n)}#v(){this.#i&&this.#c&&(this.#c.classList.remove("scroll-hidden"),this.#i=!1)}#b(){!this.#i&&this.#c&&(this.#c.classList.add("scroll-hidden"),this.#i=!0)}#y(){this.#s&&this.#s.classList.add("active")}#E(){this.#s&&this.#s.classList.remove("active")}open(){this.#e||!this.#n||(this.#e=!0,document.body.classList.add("nav-drawer-open"),this.#n.classList.add("open"),document.body.style.overflow="hidden",this.#v(),document.addEventListener("wheel",this.#u,{passive:!0}),document.addEventListener("touchmove",this.#u,{passive:!0}),setTimeout(()=>{let e=this.#n.querySelector("a[href]");e&&e.focus()},200))}close(){!this.#e||!this.#n||(this.#e=!1,document.body.classList.remove("nav-drawer-open"),this.#n.classList.remove("open"),document.body.style.overflow="",document.removeEventListener("wheel",this.#u),document.removeEventListener("touchmove",this.#u))}toggle(){this.#e?this.close():this.open()}};customElements.define("ec-mobile-nav",wt);var ot=class i extends HTMLElement{static MARKDOWN_ACTIONS={bold:{prefix:"**",suffix:"**",placeholder:"bold text"},italic:{prefix:"_",suffix:"_",placeholder:"italic text"},code:{prefix:"`",suffix:"`",placeholder:"code"},link:{prefix:"[",suffix:"](url)",placeholder:"link text"},heading:{prefix:"## ",suffix:"",placeholder:"Heading",lineStart:!0},quote:{prefix:"> ",suffix:"",placeholder:"quote",lineStart:!0}};static KEYBOARD_SHORTCUTS={b:"bold",i:"italic",k:"link","`":"code"};#e=null;#i=null;#o=!1;#r=null;connectedCallback(){let e=this.getAttribute("target");if(!e){console.warn("ec-markdown-toolbar: Missing 'target' attribute");return}requestAnimationFrame(()=>{if(this.#e=document.getElementById(e),!this.#e){console.warn(`ec-markdown-toolbar: Target #${e} not found`);return}this.#i=new AbortController,this.#t(this.#i.signal)})}disconnectedCallback(){this.#i?.abort(),this.#d()}#t(e){this.#e.addEventListener("select",()=>this.#n(),{signal:e}),this.#e.addEventListener("mouseup",()=>setTimeout(()=>this.#n(),10),{signal:e}),this.#e.addEventListener("blur",()=>this.#l(),{signal:e}),this.addEventListener("mousedown",n=>{n.preventDefault(),this.#d()},{signal:e}),this.addEventListener("click",n=>{let s=n.target.closest("[data-action]");if(s){let a=s.dataset.action;this.#h(a)}},{signal:e}),this.#e.addEventListener("keydown",n=>this.#f(n),{signal:e}),this.#e.addEventListener("scroll",()=>this.#s(),{signal:e}),window.addEventListener("resize",()=>{this.#o&&this.#a()},{signal:e})}#n(){let{selectionStart:e,selectionEnd:n}=this.#e;e!==n?(this.#c(),this.#a()):this.#s()}#a(){if(!this.#e)return;let e=this.#e,{selectionStart:n,selectionEnd:s}=e,a=e.getBoundingClientRect(),g=e.value.substring(0,n).split(`
`),p=g.length-1,x=parseInt(getComputedStyle(e).lineHeight)||24,b=e.scrollTop,m=parseInt(getComputedStyle(e).paddingTop)||0,L=parseInt(getComputedStyle(e).paddingLeft)||0,O=a.top+m+p*x-b-this.offsetHeight-8,H=a.left+L+Math.min(100,g[p].length*8),P=window.innerWidth-this.offsetWidth-16,ce=Math.max(8,O);this.style.top=`${ce}px`,this.style.left=`${Math.min(H,P)}px`}#c(){this.#d(),this.#o||(this.classList.add("visible"),this.#o=!0)}#s(){this.#d(),this.#o&&(this.classList.remove("visible"),this.#o=!1)}#l(){this.#d(),this.#r=setTimeout(()=>this.#s(),150)}#d(){this.#r&&(clearTimeout(this.#r),this.#r=null)}#h(e){let n=i.MARKDOWN_ACTIONS[e];if(!n)return;let s=this.#e,{selectionStart:a,selectionEnd:h,value:g}=s,p=g.substring(a,h),x,b,m;if(n.lineStart){let L=g.lastIndexOf(`
`,a-1)+1,O=g.substring(0,L),H=g.substring(h),P=p||n.placeholder;x=O+n.prefix+P+n.suffix+H,b=L+n.prefix.length,m=b+P.length}else{let L=g.substring(0,a),O=g.substring(h),H=p||n.placeholder;x=L+n.prefix+H+n.suffix+O,b=a+n.prefix.length,m=b+H.length}s.value=x,s.setSelectionRange(b,m),s.focus(),s.dispatchEvent(new Event("input",{bubbles:!0})),this.#s()}#f(e){if(!(e.ctrlKey||e.metaKey))return;let n=i.KEYBOARD_SHORTCUTS[e.key.toLowerCase()];n&&(e.preventDefault(),this.#h(n))}};customElements.define("ec-markdown-toolbar",ot);window.EcMarkdownToolbar=ot;var kt=class i{static#e=new Map;static register(e,n){if(!(n.prototype instanceof i))throw new Error(`${n.name} must extend EditorCore`);i.#e.set(e,n)}static create(e,n,s={}){let a=i.#e.get(e);if(!a)throw new Error(`Unknown editor type: ${e}. Available: ${[...i.#e.keys()].join(", ")}`);return new a(n,s)}static getRegisteredTypes(){return[...i.#e.keys()]}container=null;options={};#i=[];#o=[];constructor(e,n={}){if(new.target===i)throw new Error("EditorCore is abstract and cannot be instantiated directly");this.container=e,this.options=n}getContent(){throw new Error("getContent() must be implemented")}setContent(e){throw new Error("setContent() must be implemented")}getSelection(){throw new Error("getSelection() must be implemented")}insertAtCursor(e){throw new Error("insertAtCursor() must be implemented")}wrapSelection(e,n,s=""){throw new Error("wrapSelection() must be implemented")}focus(){throw new Error("focus() must be implemented")}destroy(){throw new Error("destroy() must be implemented")}onChange(e){typeof e=="function"&&this.#i.push(e)}onSelectionChange(e){typeof e=="function"&&this.#o.push(e)}_emitChange(){let e=this.getContent();this.#i.forEach(n=>n(e))}_emitSelectionChange(){let e=this.getSelection();this.#o.forEach(n=>n(e))}isEmpty(){return this.getContent().trim()===""}getWordCount(){let e=this.getContent().trim();return e?e.split(/\s+/).length:0}getCharacterCount(){return this.getContent().length}registerCommand(e,n){console.warn("Commands not supported by this editor implementation")}};window.EditorCore=kt;var st=class i extends EditorCore{#e=null;#i=null;#o=null;static ACTIONS={bold:{prefix:"**",suffix:"**",placeholder:"bold text"},italic:{prefix:"_",suffix:"_",placeholder:"italic text"},code:{prefix:"`",suffix:"`",placeholder:"code"},link:{prefix:"[",suffix:"](url)",placeholder:"link text"},heading:{prefix:"## ",suffix:"",placeholder:"Heading",lineStart:!0},quote:{prefix:"> ",suffix:"",placeholder:"quote",lineStart:!0}};static KEYBOARD_SHORTCUTS={b:"bold",i:"italic",k:"link","`":"code"};constructor(e,n={}){super(e,n),this.#e=e.querySelector("textarea")||this.#t(),n.initialContent&&this.setContent(n.initialContent),n.toolbar&&(this.#o=n.toolbar),this.#i=new AbortController,this.#n()}getContent(){return this.#e.value}setContent(e){this.#e.value=e,this._emitChange()}getSelection(){let{selectionStart:e,selectionEnd:n,value:s}=this.#e;return{start:e,end:n,text:s.substring(e,n)}}insertAtCursor(e){let{selectionStart:n,selectionEnd:s,value:a}=this.#e,h=a.substring(0,n),g=a.substring(s);this.#e.value=h+e+g;let p=n+e.length;this.#e.setSelectionRange(p,p),this._emitChange(),this.focus()}wrapSelection(e,n,s=""){let{selectionStart:a,selectionEnd:h,value:g}=this.#e,p=g.substring(a,h)||s,x=g.substring(0,a),b=g.substring(h);this.#e.value=x+e+p+n+b;let m=a+e.length,L=m+p.length;this.#e.setSelectionRange(m,L),this._emitChange(),this.focus()}focus(){this.#e.focus()}destroy(){this.#i?.abort(),this.#o=null}applyAction(e){let n=i.ACTIONS[e];n&&(n.lineStart?this.#r(n):this.wrapSelection(n.prefix,n.suffix,n.placeholder))}#r(e){let{selectionStart:n,selectionEnd:s,value:a}=this.#e,h=a.substring(n,s)||e.placeholder,g=a.lastIndexOf(`
`,n-1)+1,p=a.substring(0,g),x=a.substring(s);this.#e.value=p+e.prefix+h+e.suffix+x;let b=g+e.prefix.length,m=b+h.length;this.#e.setSelectionRange(b,m),this._emitChange(),this.focus()}#t(){let e=document.createElement("textarea");return e.className="editor-content",e.placeholder=this.options.placeholder||"Write your content...",this.container.appendChild(e),e}#n(){let{signal:e}=this.#i;this.#e.addEventListener("input",()=>{this._emitChange()},{signal:e}),this.#e.addEventListener("select",()=>{this._emitSelectionChange()},{signal:e}),this.#e.addEventListener("mouseup",()=>{setTimeout(()=>this._emitSelectionChange(),10)},{signal:e}),this.#e.addEventListener("keyup",n=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(n.key)&&this._emitSelectionChange()},{signal:e}),this.#e.addEventListener("keydown",n=>{if(!(n.ctrlKey||n.metaKey))return;let s=i.KEYBOARD_SHORTCUTS[n.key.toLowerCase()];s&&(n.preventDefault(),this.applyAction(s))},{signal:e})}};EditorCore.register("markdown",st);window.MarkdownEditor=st;(function(){"use strict";let s=null,a=null,h=null,g=null,p=!1,x=null,b=null,m=null,L=null,O=null,H=null,P=null;function ce(){x=document.querySelector("[data-editor]"),x&&(b=document.getElementById("post-editor-form"),b&&(p=x.dataset.isNew==="true",m=document.getElementById("title"),L=document.getElementById("content"),O=document.querySelector("[data-title-display]"),H=document.querySelector("[data-status]"),P=document.querySelector("[data-action-field]"),L&&L.addEventListener("input",J),g=z(),Q(),le(),X(),j(),me(),de(),A(),p&&we()))}function J(){V(),s&&clearTimeout(s),p||(s=setTimeout(()=>{se("save")},2e3))}function z(){return{title:m?.value||"",content:L?.value||"",slug:document.getElementById("slug")?.value||"",excerpt:document.getElementById("excerpt")?.value||"",cover_image:document.getElementById("cover_image")?.value||""}}function Z(){if(!g)return!1;let y=z();return y.title!==g.title||y.content!==g.content||y.slug!==g.slug||y.excerpt!==g.excerpt||y.cover_image!==g.cover_image}function V(){Z()&&W("unsaved")}function Q(){!m||!O||m.addEventListener("input",()=>{let y=m.value.trim()||"Untitled";O.textContent=y})}function le(){p||!b.dataset.autosave||(m?.addEventListener("input",J),document.querySelectorAll("[data-sync]").forEach(w=>{w.addEventListener("input",J)}))}async function se(y){if(p&&y==="save")return;let w=b.dataset.autosave;if(w){W("saving");try{let C=b.querySelector('input[name="csrf_token"]')?.value||"";P&&(P.value=y);let ee=new FormData(b),K=await fetch(w,{method:"PATCH",headers:{"X-CSRF-Token":C},body:ee});if(K.ok){let te=await K.json();g=z(),W("saved",te.updated_at),te.is_draft!==void 0&&(te.is_draft,void 0)}else{let te=await K.text();console.error("Save failed:",te),W("error",null,te)}}catch(T){console.error("Save error:",T),W("error",null,T.message)}}}function W(y,w,T){if(H)switch(y){case"saving":H.innerHTML='<span class="editor-status-saving">Saving...</span>';break;case"saved":let C=w?he(new Date(w)):"just now";H.innerHTML=`<span class="editor-status-saved" data-updated-at="${w||new Date().toISOString()}">Last saved: ${C}</span>`;break;case"unsaved":H.innerHTML='<span class="editor-status-unsaved">Unsaved changes</span>';break;case"error":let ee=T||"Save failed";H.innerHTML=`<span class="editor-status-error">${ee}</span>`;break}}function he(y){let w=new Date,T=w-y,C=Math.floor(T/1e3),ee=Math.floor(C/60),K=Math.floor(ee/60),te=Math.floor(K/24);return C<60?"just now":ee===1?"1 minute ago":ee<60?`${ee} minutes ago`:K===1?"1 hour ago":K<24?`${K} hours ago`:te===1?"yesterday":y.toLocaleDateString("en-US",{month:"short",day:"numeric",year:y.getFullYear()!==w.getFullYear()?"numeric":void 0})}function A(){h=setInterval(()=>{let y=H?.querySelector("[data-updated-at]");if(y){let w=y.dataset.updatedAt;if(w){let T=he(new Date(w));y.textContent=`Last saved: ${T}`}}},6e4)}function j(){document.querySelectorAll('[data-action-btn="save"]').forEach(y=>{y.addEventListener("click",w=>{if(w.preventDefault(),p){P&&(P.value="save");let T=document.getElementById("is_draft");T&&(T.value="true"),b.submit()}else se("save")})}),document.querySelectorAll('[data-action-btn="publish"]').forEach(y=>{y.addEventListener("click",w=>{if(w.preventDefault(),p){P&&(P.value="publish");let T=document.getElementById("is_draft");T&&(T.value="false"),b.submit()}else se("publish")})}),document.querySelectorAll('[data-action-btn="unpublish"]').forEach(y=>{y.addEventListener("click",w=>{w.preventDefault(),se("unpublish")})})}function N(y){}function me(){let y=document.querySelector("[data-dropdown-container]");if(!y)return;let w=y.querySelector("[data-dropdown-trigger]"),T=y.querySelector("[data-dropdown-menu]");!w||!T||(w.addEventListener("click",C=>{C.stopPropagation(),y.classList.toggle("open")}),document.addEventListener("click",C=>{y.contains(C.target)||y.classList.remove("open")}),document.addEventListener("keydown",C=>{C.key==="Escape"&&y.classList.remove("open")}))}function X(){document.querySelectorAll("[data-sync]").forEach(w=>{let T=w.dataset.sync,C=document.getElementById(T);C&&w.addEventListener("input",()=>{w.type==="checkbox"?C.value=w.checked?"true":"false":C.value=w.value})});let y=document.querySelector("ec-tag-select");y&&(y.addEventListener("change",()=>{_()}),y.addEventListener("click",w=>{w.target.type==="checkbox"&&setTimeout(_,0)}))}function _(){let y=document.getElementById("tag-ids-container");if(!y)return;y.innerHTML="",document.querySelectorAll('input[name="sidebar_tag_ids"]:checked').forEach(T=>{let C=document.createElement("input");C.type="hidden",C.name="tag_ids",C.value=T.value,C.dataset.tagId=T.value,y.appendChild(C)})}function de(){let y=document.querySelector("[data-preview-trigger]"),w=document.querySelector("[data-cover-preview]");!y||!w||y.addEventListener("input",()=>{a&&clearTimeout(a),a=setTimeout(()=>{Ce(y.value,w)},500)})}function Ce(y,w){let T=w.querySelector("img");if(T&&T.remove(),w.classList.remove("error"),!y)return;let C=document.createElement("img");C.src=y,C.alt="Cover preview",C.className="cover-image-preview-img",C.onload=()=>{w.classList.remove("error")},C.onerror=()=>{w.classList.add("error")},w.insertBefore(C,w.firstChild)}function we(){if(!m)return;let y=document.getElementById("slug"),w=document.getElementById("sidebar-slug"),T=!1;w&&w.addEventListener("input",()=>{T=!0}),m.addEventListener("input",()=>{if(T)return;let C=Ie(m.value);y&&(y.value=C),w&&(w.value=C)})}function Ie(y){return y.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100)}function Te(){s&&clearTimeout(s),a&&clearTimeout(a),h&&clearInterval(h)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ce):ce(),window.addEventListener("beforeunload",Te),document.addEventListener("htmx:afterSettle",ce)})();(function(){"use strict";let a={bold:{prefix:"**",suffix:"**",placeholder:"bold text"},italic:{prefix:"_",suffix:"_",placeholder:"italic text"},strikethrough:{prefix:"~~",suffix:"~~",placeholder:"strikethrough"},code:{prefix:"`",suffix:"`",placeholder:"code"},link:{prefix:"[",suffix:"](url)",placeholder:"link text"},image:{prefix:"![",suffix:"](url)",placeholder:"alt text"},heading:{prefix:"## ",suffix:"",placeholder:"Heading",lineStart:!0},quote:{prefix:"> ",suffix:"",placeholder:"quote",lineStart:!0},ul:{prefix:"- ",suffix:"",placeholder:"list item",lineStart:!0},ol:{prefix:"1. ",suffix:"",placeholder:"list item",lineStart:!0},hr:{prefix:`
---
`,suffix:"",placeholder:"",insert:!0},codeblock:{prefix:"```\n",suffix:"\n```",placeholder:"code here",block:!0},table:{prefix:"",suffix:"",placeholder:"",template:`| Header 1 | Header 2 | Header 3 |
|----------|----------|----------|
| Cell 1   | Cell 2   | Cell 3   |
| Cell 4   | Cell 5   | Cell 6   |`,insert:!0}},h={b:"bold",i:"italic",k:"link","`":"code",h:"heading",p:"toggle-preview"},g=null,p=null,x=null,b=null,m=null,L=null,O=null,H=null,P=null,ce=null,J=null,z=null,Z=null,V=null,Q=null,le=null,se=null,W=null,he=null,A=null,j=!1,N="",me=!0,X=!0;function _(){g=document.querySelector('[data-editor-type="split-markdown"]'),g&&(p=document.getElementById("post-editor-form"),p&&(j=g.dataset.isNew==="true",N=g.dataset.uploadUrl||"/admin/uploads/image",x=document.getElementById("title"),b=document.getElementById("content"),m=document.querySelector("[data-title-display]"),L=document.querySelector("[data-preview-title]"),O=document.querySelector("[data-preview-content]"),H=document.querySelector("[data-preview-pane]"),P=document.querySelector("[data-sidebar]"),ce=document.querySelector("[data-toolbar]"),J=document.querySelector("[data-status]"),z=document.querySelector("[data-action-field]"),Z=document.querySelector("[data-dropzone]"),V=document.querySelector("[data-dropzone-overlay]"),Q=document.querySelector("[data-image-input]"),A=de(),we(),Ie(),w(),C(),ke(),dt(),lt(),Me(),We(),Se(),Pe(),ee(),j&&qe(),Te(),console.log("Split Markdown Editor initialized")))}function de(){return{title:x?.value||"",content:b?.value||"",slug:document.getElementById("slug")?.value||"",excerpt:document.getElementById("excerpt")?.value||"",cover_image:document.getElementById("cover_image")?.value||""}}function Ce(){if(!A)return!1;let d=de();return d.title!==A.title||d.content!==A.content||d.slug!==A.slug||d.excerpt!==A.excerpt||d.cover_image!==A.cover_image}function we(){x&&x.addEventListener("input",()=>{let d=x.value.trim()||"Untitled";m&&(m.textContent=d),L&&(L.textContent=d)})}function Ie(){!b||!O||b.addEventListener("input",()=>{se&&clearTimeout(se),se=setTimeout(Te,300)})}function Te(){if(!b||!O)return;let d=b.value;if(!d.trim()){O.innerHTML='<p class="text-muted-foreground">Start writing to see preview...</p>';return}if(typeof marked<"u")try{let l=marked.parse(d);O.innerHTML=l,typeof hljs<"u"&&O.querySelectorAll("pre code").forEach(v=>{hljs.highlightElement(v)})}catch(l){console.error("Markdown parse error:",l),O.innerHTML='<p class="text-destructive">Error rendering preview</p>'}else O.innerHTML='<pre class="text-sm">'+y(d)+"</pre>"}function y(d){let l=document.createElement("div");return l.textContent=d,l.innerHTML}function w(){ce&&ce.addEventListener("click",d=>{let l=d.target.closest("button[data-action]");if(!l)return;let v=l.dataset.action;v==="toggle-preview"?K():a[v]&&T(v)})}function T(d){let l=a[d];if(!l||!b)return;if(d==="image"){Q&&Q.click();return}let{selectionStart:v,selectionEnd:S,value:D}=b,B=D.substring(v,S),$,G,re;if(l.insert||l.template){let ne=l.template||l.prefix,ue=D.substring(0,v),oe=D.substring(S);$=ue+ne+oe,G=v+ne.length,re=G}else if(l.lineStart){let ne=D.lastIndexOf(`
`,v-1)+1,ue=D.substring(0,ne),oe=D.substring(S),Y=B||l.placeholder;$=ue+l.prefix+Y+l.suffix+oe,G=ne+l.prefix.length,re=G+Y.length}else if(l.block){let ne=D.substring(0,v),ue=D.substring(S),oe=B||l.placeholder;$=ne+l.prefix+oe+l.suffix+ue,G=v+l.prefix.length,re=G+oe.length}else{let ne=D.substring(0,v),ue=D.substring(S),oe=B||l.placeholder;$=ne+l.prefix+oe+l.suffix+ue,G=v+l.prefix.length,re=G+oe.length}b.value=$,b.setSelectionRange(G,re),b.focus(),b.dispatchEvent(new Event("input",{bubbles:!0}))}function C(){b&&b.addEventListener("keydown",d=>{if(!(d.ctrlKey||d.metaKey))return;let l=h[d.key.toLowerCase()];l&&(d.preventDefault(),l==="toggle-preview"?K():T(l))})}function ee(){let d=document.querySelector('[data-action-btn="toggle-sidebar"]');d&&d.addEventListener("click",te)}function K(){me=!me,H&&(H.style.display=me?"":"none");let d=document.querySelector("[data-preview-toggle]");d&&d.classList.toggle("active",me),g&&g.classList.toggle("preview-hidden",!me)}function te(){X=!X,P&&(P.style.display=X?"":"none"),g&&g.classList.toggle("sidebar-hidden",!X)}function Pe(){!Z||!b||(Z.addEventListener("dragenter",rt),Z.addEventListener("dragover",Ae),Z.addEventListener("dragleave",it),Z.addEventListener("drop",at),Q&&Q.addEventListener("change",ct))}function rt(d){d.preventDefault(),d.stopPropagation(),V&&V.classList.add("active")}function Ae(d){d.preventDefault(),d.stopPropagation()}function it(d){d.preventDefault(),d.stopPropagation();let l=Z.getBoundingClientRect(),v=d.clientX,S=d.clientY;(v<l.left||v>l.right||S<l.top||S>l.bottom)&&V&&V.classList.remove("active")}function at(d){d.preventDefault(),d.stopPropagation(),V&&V.classList.remove("active");let l=d.dataTransfer?.files;l&&l.length>0&&De(l)}function ct(d){let l=d.target.files;l&&l.length>0&&De(l),d.target.value=""}async function De(d){for(let l of d){if(!l.type.startsWith("image/")){xe("error",`${l.name} is not an image`);continue}try{let v=await be(l);Ne(l.name,v),xe("success","Image uploaded successfully")}catch(v){console.error("Upload failed:",v),xe("error",`Failed to upload ${l.name}`)}}}async function be(d){let l=new FormData;l.append("image",d);let S=p?.querySelector('input[name="csrf_token"]')?.value||"",D=await fetch(N,{method:"POST",headers:{"X-CSRF-Token":S},body:l});if(!D.ok){let $=await D.json();throw new Error($.error||"Upload failed")}return(await D.json()).url}function Ne(d,l){if(!b)return;let{selectionStart:v,value:S}=b,D=S.substring(0,v),B=S.substring(v),G=`${D.length>0&&!D.endsWith(`
`)?`
`:""}![${d}](${l})
`;b.value=D+G+B;let re=v+G.length;b.setSelectionRange(re,re),b.focus(),b.dispatchEvent(new Event("input",{bubbles:!0}))}function ke(){if(j||!p?.dataset.autosave)return;let l=()=>{Ce()&&ye("unsaved"),le&&clearTimeout(le),le=setTimeout(()=>{pe("save")},2e3)};x?.addEventListener("input",l),b?.addEventListener("input",l),document.querySelectorAll("[data-sync]").forEach(v=>{v.addEventListener("input",l)})}async function pe(d){if(j&&d==="save")return;let l=p?.dataset.autosave;if(l){ye("saving");try{let S=p?.querySelector('input[name="csrf_token"]')?.value||"";z&&(z.value=d);let D=new FormData(p),B=await fetch(l,{method:"PATCH",headers:{"X-CSRF-Token":S},body:D});if(B.ok){let $=await B.json();A=de(),ye("saved",$.updated_at),$.is_draft!==void 0&&($.is_draft,void 0)}else{let $=await B.text();console.error("Save failed:",$),ye("error",null,$)}}catch(v){console.error("Save error:",v),ye("error",null,v.message)}}}function ye(d,l,v){if(J)switch(d){case"saving":J.innerHTML='<span class="editor-status-saving">Saving...</span>';break;case"saved":let S=l?Fe(new Date(l)):"just now";J.innerHTML=`<span class="editor-status-saved" data-updated-at="${l||new Date().toISOString()}">Last saved: ${S}</span>`;break;case"unsaved":J.innerHTML='<span class="editor-status-unsaved">Unsaved changes</span>';break;case"error":let D=v||"Save failed";J.innerHTML=`<span class="editor-status-error">${D}</span>`;break}}function Fe(d){let l=new Date,v=l-d,S=Math.floor(v/1e3),D=Math.floor(S/60),B=Math.floor(D/60),$=Math.floor(B/24);return S<60?"just now":D===1?"1 minute ago":D<60?`${D} minutes ago`:B===1?"1 hour ago":B<24?`${B} hours ago`:$===1?"yesterday":d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:d.getFullYear()!==l.getFullYear()?"numeric":void 0})}function Se(){he=setInterval(()=>{let d=J?.querySelector("[data-updated-at]");if(d){let l=d.dataset.updatedAt;if(l){let v=Fe(new Date(l));d.textContent=`Last saved: ${v}`}}},6e4)}function lt(){document.querySelectorAll('[data-action-btn="save"]').forEach(d=>{d.addEventListener("click",l=>{if(l.preventDefault(),j){z&&(z.value="save");let v=document.getElementById("is_draft");v&&(v.value="true"),p?.submit()}else pe("save")})}),document.querySelectorAll('[data-action-btn="publish"]').forEach(d=>{d.addEventListener("click",l=>{if(l.preventDefault(),j){z&&(z.value="publish");let v=document.getElementById("is_draft");v&&(v.value="false"),p?.submit()}else pe("publish")})}),document.querySelectorAll('[data-action-btn="unpublish"]').forEach(d=>{d.addEventListener("click",l=>{l.preventDefault(),pe("unpublish")})})}function Ue(d){}function Me(){let d=document.querySelector("[data-dropdown-container]");if(!d)return;let l=d.querySelector("[data-dropdown-trigger]"),v=d.querySelector("[data-dropdown-menu]");!l||!v||(l.addEventListener("click",S=>{S.stopPropagation(),d.classList.toggle("open")}),document.addEventListener("click",S=>{d.contains(S.target)||d.classList.remove("open")}),document.addEventListener("keydown",S=>{S.key==="Escape"&&d.classList.remove("open")}))}function dt(){document.querySelectorAll("[data-sync]").forEach(l=>{let v=l.dataset.sync,S=document.getElementById(v);S&&l.addEventListener("input",()=>{l.type==="checkbox"?S.value=l.checked?"true":"false":S.value=l.value})});let d=document.querySelector("ec-tag-select");d&&(d.addEventListener("change",ze),d.addEventListener("click",l=>{l.target.type==="checkbox"&&setTimeout(ze,0)}))}function ze(){let d=document.getElementById("tag-ids-container");if(!d)return;d.innerHTML="",document.querySelectorAll('input[name="sidebar_tag_ids"]:checked').forEach(v=>{let S=document.createElement("input");S.type="hidden",S.name="tag_ids",S.value=v.value,S.dataset.tagId=v.value,d.appendChild(S)})}function We(){let d=document.querySelector("[data-preview-trigger]"),l=document.querySelector("[data-cover-preview]");!d||!l||d.addEventListener("input",()=>{W&&clearTimeout(W),W=setTimeout(()=>{ut(d.value,l)},500)})}function ut(d,l){let v=l.querySelector("img");if(v&&v.remove(),l.classList.remove("error"),!d)return;let S=document.createElement("img");S.src=d,S.alt="Cover preview",S.className="cover-image-preview-img",S.onload=()=>l.classList.remove("error"),S.onerror=()=>l.classList.add("error"),l.insertBefore(S,l.firstChild)}function qe(){if(!x)return;let d=document.getElementById("slug"),l=document.getElementById("sidebar-slug"),v=!1;l&&l.addEventListener("input",()=>{v=!0}),x.addEventListener("input",()=>{if(v)return;let S=Ke(x.value);d&&(d.value=S),l&&(l.value=S)})}function Ke(d){return d.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").substring(0,100)}function xe(d,l){let v=document.querySelector("ec-toast-container");v&&typeof v.show=="function"?v.show(l,d):console.log(`[${d}] ${l}`)}function Ge(){le&&clearTimeout(le),se&&clearTimeout(se),W&&clearTimeout(W),he&&clearInterval(he)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_(),window.addEventListener("beforeunload",Ge),document.addEventListener("htmx:afterSettle",_)})();})();
