@import "tailwindcss";

/* Source detection */
@source "../../templates/**/*.templ";
@source "../../templates/**/*_templ.go";

/* Self-hosted Geist font (primary sans-serif) */
@font-face {
  font-family: "Geist";
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url("/static/fonts/geist-400.woff2") format("woff2");
}

@font-face {
  font-family: "Geist";
  font-style: normal;
  font-weight: 500;
  font-display: swap;
  src: url("/static/fonts/geist-500.woff2") format("woff2");
}

@font-face {
  font-family: "Geist";
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: url("/static/fonts/geist-600.woff2") format("woff2");
}

/* Self-hosted JetBrains Mono font (code/badges/kbd) */
@font-face {
  font-family: "JetBrains Mono";
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: url("/static/fonts/jetbrains-mono-400.woff2") format("woff2");
}

@font-face {
  font-family: "JetBrains Mono";
  font-style: normal;
  font-weight: 500;
  font-display: swap;
  src: url("/static/fonts/jetbrains-mono-500.woff2") format("woff2");
}

@font-face {
  font-family: "JetBrains Mono";
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: url("/static/fonts/jetbrains-mono-600.woff2") format("woff2");
}

/* Refined Minimal + Technical Design - Light Mode (Slate + Blue) */
@theme {
  /* Typography - Geist for UI, JetBrains Mono for code */
  --font-sans: "Geist", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-mono: "JetBrains Mono", "SF Mono", "Fira Code", Consolas, monospace;

  /* Transition tokens */
  --duration-instant: 0ms;
  --duration-fast: 100ms;
  --duration-normal: 150ms;
  --duration-slow: 200ms;
  --duration-slower: 300ms;

  /* Shadow tokens - refined, layered (light mode) */
  --shadow-sm: 0 1px 3px rgb(0 0 0 / 0.06), 0 1px 2px rgb(0 0 0 / 0.03);
  --shadow-md: 0 4px 6px rgb(0 0 0 / 0.07), 0 2px 4px rgb(0 0 0 / 0.05);
  --shadow-lg: 0 10px 15px rgb(0 0 0 / 0.08), 0 4px 6px rgb(0 0 0 / 0.05);

  /* Slate + Blue palette */
  --color-background: hsl(220 20% 97%);
  --color-foreground: hsl(220 25% 10%);
  --color-card: hsl(220 20% 99%);
  --color-card-foreground: hsl(220 25% 10%);
  --color-popover: hsl(220 20% 99%);
  --color-popover-foreground: hsl(220 25% 10%);
  --color-primary: hsl(220 60% 50%);
  --color-primary-foreground: hsl(0 0% 100%);
  --color-secondary: hsl(220 15% 92%);
  --color-secondary-foreground: hsl(220 25% 10%);
  --color-muted: hsl(220 15% 94%);
  --color-muted-foreground: hsl(220 10% 45%);
  --color-accent: hsl(220 60% 50%);
  --color-accent-foreground: hsl(0 0% 100%);
  --color-destructive: hsl(0 84% 60%);
  --color-destructive-foreground: hsl(0 0% 98%);
  --color-border: hsl(220 15% 88%);
  --color-input: hsl(220 15% 85%);
  --color-ring: hsl(220 60% 50%);
  --color-sidebar: hsl(220 18% 95%);

  /* Link colors (blue-based) */
  --color-link: hsl(220 60% 45%);
  --color-link-hover: hsl(220 60% 35%);

  /* Subtle radius - refined, not sharp */
  --radius-sm: 0.125rem;
  --radius-md: 0.25rem;
  --radius-lg: 0.375rem;
  --radius-xl: 0.5rem;
}

/* Dark Mode - class-based with system preference fallback */
/* Applied when .dark class is on <html> OR when system prefers dark and no explicit preference set */
.dark,
html:not(.light):not(.dark) {
  @media (prefers-color-scheme: dark) {
    color-scheme: dark;

    /* Slate + Blue dark palette */
    --color-background: hsl(220 20% 8%);
    --color-foreground: hsl(220 10% 92%);
    --color-card: hsl(220 18% 11%);
    --color-card-foreground: hsl(220 10% 92%);
    --color-popover: hsl(220 18% 13%);
    --color-popover-foreground: hsl(220 10% 92%);
    --color-primary: hsl(220 70% 60%);
    --color-primary-foreground: hsl(220 20% 8%);
    --color-secondary: hsl(220 15% 16%);
    --color-secondary-foreground: hsl(220 10% 92%);
    --color-muted: hsl(220 15% 18%);
    --color-muted-foreground: hsl(220 10% 55%);
    --color-accent: hsl(220 70% 60%);
    --color-accent-foreground: hsl(220 20% 8%);
    --color-destructive: hsl(0 72% 51%);
    --color-destructive-foreground: hsl(0 0% 98%);
    --color-border: hsl(220 15% 20%);
    --color-input: hsl(220 15% 22%);
    --color-ring: hsl(220 70% 60%);
    --color-sidebar: hsl(220 18% 6%);
    --color-link: hsl(220 70% 65%);
    --color-link-hover: hsl(220 70% 75%);

    /* Shadows for dark mode - refined, layered */
    --shadow-sm: 0 1px 3px rgb(0 0 0 / 0.15), 0 1px 2px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px rgb(0 0 0 / 0.2), 0 2px 4px rgb(0 0 0 / 0.15);
    --shadow-lg: 0 10px 15px rgb(0 0 0 / 0.25), 0 4px 6px rgb(0 0 0 / 0.15);
  }
}

/* Explicit dark mode override (when user manually selects dark) */
.dark {
  color-scheme: dark;

  /* Slate + Blue dark palette */
  --color-background: hsl(220 20% 8%);
  --color-foreground: hsl(220 10% 92%);
  --color-card: hsl(220 18% 11%);
  --color-card-foreground: hsl(220 10% 92%);
  --color-popover: hsl(220 18% 13%);
  --color-popover-foreground: hsl(220 10% 92%);
  --color-primary: hsl(220 70% 60%);
  --color-primary-foreground: hsl(220 20% 8%);
  --color-secondary: hsl(220 15% 16%);
  --color-secondary-foreground: hsl(220 10% 92%);
  --color-muted: hsl(220 15% 18%);
  --color-muted-foreground: hsl(220 10% 55%);
  --color-accent: hsl(220 70% 60%);
  --color-accent-foreground: hsl(220 20% 8%);
  --color-destructive: hsl(0 72% 51%);
  --color-destructive-foreground: hsl(0 0% 98%);
  --color-border: hsl(220 15% 20%);
  --color-input: hsl(220 15% 22%);
  --color-ring: hsl(220 70% 60%);
  --color-sidebar: hsl(220 18% 6%);
  --color-link: hsl(220 70% 65%);
  --color-link-hover: hsl(220 70% 75%);

  /* Shadows for dark mode - refined, layered */
  --shadow-sm: 0 1px 3px rgb(0 0 0 / 0.15), 0 1px 2px rgb(0 0 0 / 0.1);
  --shadow-md: 0 4px 6px rgb(0 0 0 / 0.2), 0 2px 4px rgb(0 0 0 / 0.15);
  --shadow-lg: 0 10px 15px rgb(0 0 0 / 0.25), 0 4px 6px rgb(0 0 0 / 0.15);
}

@layer base {
  /* Disable ALL transitions during theme switch */
  html.no-transitions,
  html.no-transitions *,
  html.no-transitions *::before,
  html.no-transitions *::after {
    transition-duration: 0s !important;
    transition-delay: 0s !important;
    animation-duration: 0s !important;
    animation-delay: 0s !important;
  }

  * {
    @apply border-border;
  }

  *::marker {
    display: none;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings:
      "liga" 1,
      "calt" 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Link styling with accent color */
  a:not([class]) {
    color: var(--color-link);
    text-decoration: underline;
    text-underline-offset: 2px;
    transition: color 0.15s ease;
  }

  a:not([class]):hover {
    color: var(--color-link-hover);
  }

  /* Sharp focus styles */
  :focus-visible {
    @apply outline-none ring-2 ring-ring ring-offset-2 ring-offset-background;
  }

  /* Touch optimization - prevents double-tap zoom delay */
  button,
  a,
  [role="button"],
  input,
  select,
  textarea {
    touch-action: manipulation;
  }

  /* Base kbd styling - rounded box with subtle style */
  kbd {
    @apply inline-flex items-center justify-center px-1.5 py-0.5 font-mono;
    @apply text-xs font-medium rounded;
    @apply border border-border/50 bg-muted/50 text-muted-foreground;
  }
}

@layer components {
  /* ===== 3-COLUMN LAYOUT ===== */
  .layout-container {
    @apply flex flex-1 overflow-hidden bg-background;
  }

  /* Left Sidebar */
  .left-sidebar {
    @apply hidden lg:flex lg:flex-col lg:w-60 xl:w-72 border-r border-border/50 bg-sidebar;
  }

  .left-sidebar-content {
    @apply flex flex-col h-full p-5;
  }

  /* Middle Column */
  .middle-column {
    @apply hidden lg:flex lg:flex-col lg:w-72 xl:w-80 border-r border-border/50 bg-sidebar;
  }

  .middle-column-header {
    @apply sticky top-0 z-10 flex items-center justify-between border-b border-border bg-sidebar px-5 py-3;
  }

  .middle-column-content {
    @apply flex-1 overflow-y-auto p-3;
  }

  /* Main Content */
  .main-content {
    @apply flex-1 flex flex-col bg-background overflow-hidden;
  }

  .main-content-dots {
    /* Removed dot pattern for cleaner look */
  }

  .main-content-scroll {
    @apply flex-1 overflow-y-auto;
  }

  .main-content-inner {
    @apply p-6 sm:p-8 lg:p-16 max-w-4xl mx-auto pb-20 lg:pb-16;
  }

  /* ===== MOBILE BOTTOM BAR ===== */
  .mobile-bottom-bar {
    @apply fixed bottom-0 left-0 right-0 z-40 flex items-center justify-between px-3 h-14 lg:hidden;
    @apply bg-sidebar/95 backdrop-blur-sm border-t border-border/50;
    padding-bottom: env(safe-area-inset-bottom, 0);
    transition: transform 200ms ease-out;
  }

  .mobile-bottom-bar.scroll-hidden {
    transform: translateY(100%);
  }

  .mobile-bar-btn {
    @apply flex items-center justify-center w-10 h-10 text-muted-foreground rounded-full;
    transition-property: color, background-color;
    transition-duration: var(--duration-normal);
  }

  .mobile-bar-btn:active {
    @apply text-foreground bg-muted/50;
  }

  .mobile-bar-title {
    @apply flex items-center gap-2 text-sm font-medium text-foreground;
  }

  .mobile-bar-logo {
    @apply flex h-6 w-6 shrink-0 items-center justify-center rounded-full text-[10px] font-medium bg-primary text-primary-foreground;
  }

  .mobile-bar-separator {
    @apply text-muted-foreground;
  }

  .mobile-bar-page {
    @apply text-muted-foreground;
  }

  /* Theme icon visibility based on current theme */
  .theme-icon-sun {
    @apply hidden;
  }

  .theme-icon-moon {
    @apply block;
  }

  .dark .theme-icon-sun {
    @apply block;
  }

  .dark .theme-icon-moon {
    @apply hidden;
  }

  /* ===== NAV DRAWER ===== */
  .nav-drawer-backdrop {
    @apply fixed inset-0 z-40 pointer-events-none lg:hidden;
    background: rgba(0, 0, 0, 0.4);
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 200ms ease-out,
      visibility 200ms ease-out;
  }

  body.nav-drawer-open .nav-drawer-backdrop {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .nav-drawer {
    @apply fixed inset-x-0 bottom-0 z-50 bg-sidebar rounded-t-2xl lg:hidden;
    transform: translateY(100%);
    transition: transform 200ms ease-out;
    padding-bottom: env(safe-area-inset-bottom, 0);
  }

  .nav-drawer.open {
    transform: translateY(0);
  }

  .nav-drawer-handle {
    @apply flex justify-center py-3;
  }

  .nav-drawer-handle::before {
    content: "";
    @apply w-10 h-1 bg-border rounded-full;
  }

  .nav-drawer-section {
    @apply px-4 pb-4;
  }

  .nav-drawer-section-secondary {
    @apply border-t border-border pt-4;
  }

  .nav-drawer-label {
    @apply block text-xs font-medium text-muted-foreground uppercase tracking-wider mb-2 px-3;
  }

  .nav-drawer-item {
    @apply flex items-center gap-3 px-3 py-3 text-base font-medium text-muted-foreground rounded-lg;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  .nav-drawer-item:active {
    @apply bg-muted/50;
  }

  .nav-drawer-item-active {
    @apply text-primary bg-primary/10;
  }

  .nav-drawer-link {
    @apply flex items-center gap-3 px-3 py-2.5 text-sm text-muted-foreground rounded-lg;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  .nav-drawer-link:active {
    @apply bg-muted/50;
  }

  .nav-drawer-link span {
    @apply flex-1;
  }

  .nav-drawer-external {
    @apply text-muted-foreground/50;
  }

  /* Scale effect on layout when drawer is open */
  .layout-container {
    transition:
      transform 200ms ease-out,
      border-radius 200ms ease-out;
    transform-origin: center bottom;
  }

  body.nav-drawer-open .layout-container {
    transform: scale(0.94) translateY(-2%);
    border-radius: 12px;
    overflow: hidden;
  }

  /* Prevent interaction with scaled content */
  body.nav-drawer-open .layout-container * {
    pointer-events: none;
  }

  /* ===== NAV LOADING INDICATOR ===== */
  .nav-loading-indicator {
    @apply fixed inset-0 z-[60] flex items-center justify-center pointer-events-none lg:hidden;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 150ms ease-out,
      visibility 150ms ease-out;
  }

  .nav-loading-indicator.active {
    opacity: 1;
    visibility: visible;
  }

  .nav-loading-spinner {
    @apply w-6 h-6 border-2 border-muted-foreground/30 rounded-full;
    border-top-color: var(--color-foreground);
    animation: nav-spin 600ms linear infinite;
  }

  @keyframes nav-spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* ===== MOBILE COLLECTION BAR ===== */
  .mobile-collection-bar {
    @apply flex lg:hidden overflow-x-auto gap-2 px-4 py-3 bg-sidebar border-b border-border;
    /* Hide scrollbar but allow scroll */
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .mobile-collection-bar::-webkit-scrollbar {
    display: none;
  }

  .collection-chip {
    @apply inline-flex items-center gap-1.5 whitespace-nowrap px-3 py-1.5 text-sm font-medium text-muted-foreground bg-muted/50 border border-border/50 rounded-full shrink-0;
    transition-property: background-color, color, border-color;
    transition-duration: var(--duration-normal);
  }

  .collection-chip:hover {
    @apply text-foreground bg-muted;
  }

  .collection-chip-active {
    @apply bg-primary/10 text-primary border-primary/30;
  }

  .collection-chip-count {
    @apply text-xs opacity-70;
  }

  /* ===== MOBILE POST LIST (Full list view) ===== */
  .mobile-post-list {
    @apply flex flex-col lg:hidden p-4 pb-20 gap-3;
  }

  .mobile-post-list-item {
    @apply block p-4 bg-card border border-border/50 rounded-lg;
    box-shadow: var(--shadow-sm);
    transition:
      transform var(--duration-normal) ease,
      box-shadow var(--duration-normal) ease;
  }

  .mobile-post-list-item:active {
    transform: scale(0.98);
    box-shadow: var(--shadow-md);
  }

  .mobile-post-list-item-title {
    @apply text-base font-semibold text-foreground leading-tight;
  }

  .mobile-post-list-item-meta {
    @apply flex flex-wrap items-center gap-2 mt-2 text-sm text-muted-foreground;
  }

  .mobile-post-list-item-excerpt {
    @apply mt-3 text-sm text-muted-foreground leading-relaxed line-clamp-2;
  }

  /* Accent-colored tag pills in mobile post list */
  .mobile-post-list-item .badge-secondary {
    @apply bg-primary/10 text-primary border border-primary/20 font-medium rounded-full;
  }

  /* ===== MOBILE BACK LINK ===== */
  .mobile-back-link {
    @apply flex lg:hidden items-center gap-1 mb-4 text-sm font-medium text-muted-foreground hover:text-foreground;
    transition-property: color;
    transition-duration: var(--transition-duration);
  }

  /* ===== ADMIN MOBILE HEADER ===== */
  .admin-mobile-header {
    @apply sticky top-0 z-40 flex lg:hidden items-center justify-between px-4 py-3 bg-sidebar border-b border-border;
  }

  .admin-mobile-header-btn {
    @apply flex items-center justify-center w-10 h-10 text-muted-foreground hover:text-foreground hover:bg-muted;
    transition-property: background-color, color;
    transition-duration: var(--transition-duration);
  }

  /* ===== ADMIN BOTTOM NAVIGATION ===== */
  .admin-bottom-nav {
    @apply fixed bottom-0 left-0 right-0 z-40 flex lg:hidden bg-sidebar border-t border-border;
    padding-bottom: env(safe-area-inset-bottom, 0);
  }

  .admin-bottom-nav-item {
    @apply flex-1 flex flex-col items-center justify-center gap-1 py-2 text-muted-foreground;
    transition-property: color;
    transition-duration: var(--transition-duration);
    min-height: 56px;
  }

  .admin-bottom-nav-item:hover {
    @apply text-foreground;
  }

  .admin-bottom-nav-item-active {
    @apply text-primary;
  }

  .admin-bottom-nav-label {
    @apply text-[10px] font-medium;
  }

  /* Height calculation for mobile header offset */
  .h-screen-minus-header {
    height: calc(
      100vh - 52px
    ); /* 52px = mobile header height (py-3 = 12px*2 + content) */
  }

  /* ===== PROFILE CARD ===== */
  .profile-card {
    @apply flex items-center gap-3 p-2 rounded-lg hover:bg-muted/50;
    transition-property: background-color;
    transition-duration: var(--duration-normal);
  }

  .profile-avatar {
    @apply flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-sm font-medium bg-primary text-primary-foreground;
  }

  .profile-info {
    @apply flex flex-col;
  }

  .profile-name {
    @apply font-semibold tracking-tight text-foreground;
  }

  .profile-title {
    @apply text-sm text-muted-foreground;
  }

  /* ===== NAV LINKS (Left Sidebar) ===== */
  .nav-item {
    @apply flex items-center justify-between p-2 text-sm font-medium text-muted-foreground rounded-md hover:bg-muted/50 hover:text-foreground;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  .nav-item-active {
    @apply flex items-center justify-between p-2 text-sm font-medium rounded-md bg-primary/10 text-primary;
  }

  .nav-item-icon {
    @apply flex items-center gap-2;
  }

  /* Keyboard shortcut styling */
  .nav-item kbd,
  .nav-item-active kbd {
    @apply hidden lg:inline-flex items-center justify-center font-mono;
    @apply size-5 text-xs font-medium rounded;
    @apply border border-border/50 bg-muted/50 text-muted-foreground;
  }

  .nav-item-active kbd {
    @apply border-primary/30 bg-primary/10 text-primary;
  }

  /* ===== SOCIAL LINKS ===== */
  .social-section-title {
    @apply px-2 text-xs font-medium uppercase tracking-wider text-muted-foreground;
  }

  .social-link {
    @apply flex items-center justify-between gap-2 p-2 text-sm font-medium text-foreground rounded-md hover:bg-muted/50;
    transition-property: background-color;
    transition-duration: var(--duration-normal);
  }

  .social-link-inner {
    @apply flex items-center gap-2;
  }

  /* ===== THEME TOGGLE ===== */
  .theme-toggle {
    @apply flex items-center gap-2 p-2 text-sm font-medium text-foreground hover:bg-muted w-full cursor-pointer;
    transition-property: background-color;
    transition-duration: var(--transition-duration);
  }

  /* ===== LIST ITEM (Middle Column) ===== */
  /* Horizontal layout - for bookmarks (title left, count right) */
  .list-item {
    @apply flex items-center justify-between p-2 text-sm font-medium text-muted-foreground rounded-md hover:bg-muted/50 hover:text-foreground;
    display: flex !important;
    list-style: none !important;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  .list-item-active {
    @apply flex items-center justify-between p-2 text-sm font-medium rounded-md bg-primary/10 text-primary;
    display: flex !important;
    list-style: none !important;
  }

  .list-item-count {
    @apply text-xs text-muted-foreground;
  }

  .list-item-active .list-item-count {
    @apply text-primary/70;
  }

  /* Stacked layout - for posts (title + date on two lines) */
  .list-item-stacked {
    @apply flex flex-col gap-0.5 p-2 text-sm rounded-md hover:bg-muted/50;
    display: flex !important;
    list-style: none !important;
    transition-property: background-color;
    transition-duration: var(--duration-normal);
  }

  .list-item-stacked-active {
    @apply flex flex-col gap-0.5 p-2 text-sm rounded-md bg-primary/10;
    display: flex !important;
    list-style: none !important;
  }

  .list-item-stacked .list-item-title {
    @apply font-medium text-foreground;
  }

  .list-item-stacked:hover .list-item-title {
    @apply text-foreground;
  }

  .list-item-stacked-active .list-item-title {
    @apply text-primary;
  }

  .list-item-stacked .list-item-meta {
    @apply text-xs text-muted-foreground;
  }

  .list-item-stacked-active .list-item-meta {
    @apply text-primary/70;
  }

  /* ===== EMPTY STATE ===== */
  .empty-state {
    @apply flex flex-col items-center justify-center h-full min-h-[400px] text-center;
  }

  .empty-state-icon {
    @apply mb-4 border border-border bg-muted p-4 text-muted-foreground;
  }

  .empty-state-title {
    @apply text-lg font-semibold text-foreground;
  }

  .empty-state-description {
    @apply mt-1 text-muted-foreground;
  }

  /* ===== BUTTONS ===== */
  /* Note: Use explicit transition-property to avoid border-color flashing on theme switch */
  .btn-default {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring
           focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50
           bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-5 py-2 rounded-md;
    box-shadow: var(--shadow-sm);
    transition-property: background-color, color, box-shadow, transform;
    transition-duration: var(--duration-normal);
  }

  .btn-default:hover {
    box-shadow: var(--shadow-md);
  }

  .btn-destructive {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring
           focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50
           bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-5 py-2 rounded-md;
    box-shadow: var(--shadow-sm);
    transition-property: background-color, color, box-shadow, transform;
    transition-duration: var(--duration-normal);
  }

  .btn-destructive:hover {
    box-shadow: var(--shadow-md);
  }

  .btn-outline {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring
           focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50
           border border-input bg-background hover:bg-muted hover:text-foreground h-10 px-5 py-2 rounded-md;
    transition-property: background-color, color, box-shadow;
    transition-duration: var(--duration-normal);
  }

  .btn-outline:hover {
    box-shadow: var(--shadow-sm);
  }

  .btn-secondary {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring
           focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50
           bg-secondary text-secondary-foreground hover:bg-secondary/80 h-10 px-5 py-2 rounded-md;
    transition-property: background-color, color, box-shadow;
    transition-duration: var(--duration-normal);
  }

  .btn-secondary:hover {
    box-shadow: var(--shadow-sm);
  }

  .btn-ghost {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring
           focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50
           hover:bg-muted hover:text-foreground h-10 px-5 py-2 rounded-md;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  .btn-link {
    @apply inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring
           focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50
           text-primary underline-offset-4 hover:underline h-auto p-0;
    transition-property: color;
    transition-duration: var(--duration-normal);
  }

  .btn-sm {
    @apply h-9 px-4 text-sm rounded-md;
  }

  .btn-xs {
    @apply h-7 px-3 text-xs rounded;
  }

  .btn-lg {
    @apply h-11 px-8 rounded-md;
  }

  .btn-icon {
    @apply h-10 w-10 p-0 rounded-md;
  }

  /* ===== CARDS ===== */
  .card {
    @apply border border-border/50 bg-card text-card-foreground rounded-lg;
    box-shadow: var(--shadow-sm);
    transition-property: transform, box-shadow;
    transition-duration: var(--duration-slow);
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .card-header {
    @apply flex flex-col space-y-1.5 p-6;
  }

  .card-title {
    @apply text-2xl font-semibold leading-none tracking-tight;
  }

  .card-description {
    @apply text-sm text-muted-foreground;
  }

  .card-content {
    @apply p-6 pt-0;
  }

  .card-footer {
    @apply flex items-center p-6 pt-0;
  }

  /* ===== INPUTS ===== */
  .input {
    @apply flex h-10 w-full border border-input bg-background px-3 py-2 text-sm rounded-md
           ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium
           placeholder:text-muted-foreground/60 focus-visible:outline-none focus-visible:ring-2
           focus-visible:ring-primary/20 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50;
    transition-property: border-color, box-shadow;
    transition-duration: var(--duration-normal);
  }

  .textarea {
    @apply flex min-h-20 w-full border border-input bg-background px-3 py-2 text-sm rounded-md
           ring-offset-background placeholder:text-muted-foreground/60 focus-visible:outline-none
           focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary
           disabled:cursor-not-allowed disabled:opacity-50;
    transition-property: border-color, box-shadow;
    transition-duration: var(--duration-normal);
  }

  .label {
    @apply text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70;
  }

  /* ===== BADGES ===== */
  /* Note: Badges don't have transitions - they're static display elements */
  .badge-default {
    @apply inline-flex items-center border px-2.5 py-0.5 text-xs font-medium rounded-full
           focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2
           border-transparent bg-primary/10 text-primary;
  }

  .badge-secondary {
    @apply inline-flex items-center border px-2.5 py-0.5 text-xs font-medium rounded-full
           focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2
           border-transparent bg-secondary text-secondary-foreground;
  }

  .badge-destructive {
    @apply inline-flex items-center border px-2.5 py-0.5 text-xs font-medium rounded-full
           focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2
           border-transparent bg-destructive/10 text-destructive;
  }

  .badge-outline {
    @apply inline-flex items-center border px-2.5 py-0.5 text-xs font-medium rounded-full
           focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2
           text-foreground border-border;
  }

  /* Compact status badges (for tables) */
  .badge-success {
    @apply inline-flex items-center gap-0.5 text-[10px] text-green-700 bg-green-50 border border-green-200 px-1.5 py-0.5 rounded-full;
  }

  .badge-warning {
    @apply inline-flex items-center gap-0.5 text-[10px] text-amber-700 bg-amber-50 border border-amber-200 px-1.5 py-0.5 rounded-full;
  }

  .badge-muted {
    @apply inline-flex items-center gap-0.5 text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded-full;
  }

  .badge-info {
    @apply inline-flex items-center gap-0.5 text-[10px] text-blue-700 bg-blue-50 border border-blue-200 px-1.5 py-0.5 rounded-full;
  }

  .badge-error {
    @apply inline-flex items-center gap-0.5 text-[10px] text-red-700 bg-red-50 border border-red-200 px-1.5 py-0.5 rounded-full;
  }

  /* ===== ROW ACTIONS ===== */
  .row-actions {
    @apply flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity;
  }

  /* ===== TREE ROW (Expandable content) ===== */
  /* Note: Add 'group' class in HTML to enable .row-actions hover reveal */
  .tree-row {
    @apply flex items-center gap-2 pl-6 pr-3 py-1.5 hover:bg-muted/30;
  }

  .tree-indicator {
    @apply text-muted-foreground/50 text-xs w-3 shrink-0 text-center font-normal;
  }

  .tree-row-more {
    @apply flex items-center gap-2 pl-6 pr-3 py-1.5 text-xs;
  }

  /* ===== FILTER BAR ===== */
  .filter-bar {
    @apply flex flex-wrap items-center gap-2 py-2 border-b border-border text-xs;
  }

  /* ===== EMPTY STATE ===== */
  .empty-state {
    @apply flex flex-col items-center justify-center py-12 text-center;
  }

  .empty-state-icon {
    @apply bg-muted p-4 mb-4 rounded-lg;
  }

  .empty-state-title {
    @apply font-semibold text-foreground mb-1;
  }

  .empty-state-description {
    @apply text-muted-foreground mb-4;
  }

  /* ===== SEPARATOR ===== */
  .separator-horizontal {
    @apply shrink-0 bg-border h-px w-full my-4;
  }

  .separator-vertical {
    @apply shrink-0 bg-border h-full w-px;
  }

  /* ===== SIDEBAR (Admin) ===== */
  .sidebar-link {
    @apply flex items-center gap-2 p-2 text-sm font-medium text-muted-foreground rounded-md hover:bg-muted/50 hover:text-foreground;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  .sidebar-link-active {
    @apply flex items-center gap-2 p-2 text-sm font-medium rounded-md bg-primary/10 text-primary;
  }

  /* ===== POST CARD (Home page) ===== */
  .post-card {
    @apply block py-6 -mx-4 px-4 rounded-lg hover:bg-muted/30;
    transition-property: background-color;
    transition-duration: var(--duration-slow);
  }

  .post-card-title {
    @apply text-lg font-semibold text-foreground group-hover:text-primary;
    transition-property: color;
    transition-duration: var(--duration-normal);
  }

  .post-card-excerpt {
    @apply mt-2 text-muted-foreground line-clamp-2;
  }

  .post-card-meta {
    @apply mt-3 flex items-center gap-2 text-sm text-muted-foreground;
  }

  /* ===== BOOKMARK CARD ===== */
  .bookmark-card {
    @apply block overflow-hidden border border-border/50 bg-card rounded-lg;
    box-shadow: var(--shadow-sm);
    transition-property: transform, box-shadow;
    transition-duration: var(--duration-slow);

    &:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
  }

  /* Image wrapper for loading states */
  .bookmark-card-image-wrapper {
    @apply relative aspect-video w-full bg-muted overflow-hidden rounded-t-lg;
  }

  /* Skeleton pulse animation */
  .bookmark-card-image-wrapper::before {
    content: "";
    @apply absolute inset-0 bg-muted;
    animation: skeleton-pulse 1.5s ease-in-out infinite;
  }

  .bookmark-card-image-wrapper.loaded::before {
    display: none;
  }

  @keyframes skeleton-pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  /* Image with fade-in - use object-cover for better cropping */
  .bookmark-card-image {
    @apply absolute inset-0 w-full h-full object-cover object-center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .bookmark-card-image-wrapper.loaded .bookmark-card-image {
    opacity: 1;
  }

  /* Fallback when no image or error */
  .bookmark-card-fallback {
    @apply absolute inset-0 flex items-center justify-center bg-muted;
  }

  .bookmark-card-fallback span {
    @apply text-4xl font-medium text-muted-foreground;
  }

  .bookmark-card-content {
    @apply p-4;
  }

  .bookmark-card-title {
    @apply font-medium text-foreground break-words
           group-hover:text-primary;
    transition-property: color;
    transition-duration: var(--transition-duration);
  }

  .bookmark-card-domain {
    @apply mt-1 text-sm text-muted-foreground;
  }

  .bookmark-card-description {
    @apply mt-2 text-xs text-muted-foreground break-words;
  }

  /* ===== BOOKMARK GRID (JS Masonry) ===== */
  .masonry-grid {
    position: relative;
    /* Height set dynamically by JS */
  }

  .masonry-item {
    /* Position set by JS, smooth transition on resize */
    transition:
      left 0.3s ease,
      top 0.3s ease,
      width 0.3s ease;
  }

  /* No-JS fallback: use CSS Grid */
  .no-js .masonry-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
  }

  .no-js .masonry-item {
    position: static !important;
    width: auto !important;
    left: auto !important;
    top: auto !important;
  }

  /* ===== BAR CHART ===== */
  .bar-chart-fill {
    width: var(--bar-width, 0%);
  }

  /* ===== STAT CARD ===== */
  .stat-card {
    @apply border border-border/50 bg-card p-6 rounded-lg hover:bg-muted/30;
    transition-property: background-color;
    transition-duration: var(--duration-normal);
  }

  .stat-card-label {
    @apply text-sm font-medium text-muted-foreground;
  }

  .stat-card-value {
    @apply mt-2 text-3xl font-bold text-foreground;
  }

  /* ===== ALERT ===== */
  .alert {
    @apply relative w-full border p-4 rounded-md;
  }

  .alert-destructive {
    @apply relative w-full border p-4 rounded-md border-destructive/50 text-destructive;
  }

  /* ===== TABLE ===== */
  /* Responsive table wrapper for horizontal scroll on mobile */
  .table-wrapper {
    @apply w-full overflow-x-auto;
    -webkit-overflow-scrolling: touch;
  }

  .table {
    @apply w-full caption-bottom text-xs;
    table-layout: fixed;
    min-width: 600px; /* Ensures table doesn't collapse too much on mobile */
  }

  .table-header {
    @apply [&_tr]:border-b;
  }

  .table-body {
    @apply [&_tr:last-child]:border-0;
  }

  .table-row {
    @apply border-b hover:bg-muted/50 data-[state=selected]:bg-muted;
    transition-property: background-color;
    transition-duration: var(--transition-duration);
  }

  /* Show row actions on focus-within (keyboard navigation) */
  .table-row:focus-within .row-actions {
    opacity: 1;
  }

  .table-head {
    @apply h-9 px-3 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0;
  }

  .table-cell {
    @apply px-3 py-2 align-middle [&:has([role=checkbox])]:pr-0;
  }

  /* Use inset focus ring for elements inside table cells to prevent clipping by overflow-hidden */
  .table-cell :focus-visible {
    @apply ring-inset ring-offset-0;
  }

  /* ===== CUSTOM DROPDOWN (ec-dropdown Web Component) ===== */
  ec-dropdown {
    @apply relative w-36;
    display: block;
  }

  ec-dropdown [data-trigger] {
    @apply flex items-center justify-between gap-2 w-full
           bg-background border border-input px-2 h-8 text-xs text-left rounded-md
           hover:bg-muted/50 cursor-pointer;
    transition-property: background-color;
    transition-duration: var(--duration-normal);
  }

  ec-dropdown [data-label] {
    @apply truncate;
  }

  /* Menu styles - both in ec-dropdown and portal */
  ec-dropdown [data-menu],
  #dropdown-portal [data-menu] {
    @apply fixed z-100 bg-card border border-border/50 max-h-60 overflow-y-auto rounded-md;
    box-shadow: var(--shadow-lg);
    display: none;
  }

  /* Option styles - both in ec-dropdown and portal */
  ec-dropdown [data-option],
  #dropdown-portal [data-option] {
    @apply block w-full px-2 py-1.5 text-xs text-left text-foreground
           hover:bg-muted/50 cursor-pointer truncate;
    transition-property: background-color;
    transition-duration: var(--duration-fast);
  }

  ec-dropdown [data-option][data-selected="true"],
  #dropdown-portal [data-option][data-selected="true"] {
    @apply bg-primary/10 text-primary font-medium;
  }

  /* ===== AVATAR ===== */
  .avatar {
    @apply relative flex h-10 w-10 shrink-0 overflow-hidden;
  }

  .avatar-image {
    @apply aspect-square h-full w-full;
  }

  .avatar-fallback {
    @apply flex h-full w-full items-center justify-center bg-muted text-sm font-medium;
  }

  /* ===== ARTICLE CONTENT ===== */
  .article-header {
    @apply mb-6 space-y-2;
  }

  .article-title {
    @apply text-2xl font-bold tracking-tight text-foreground lg:text-3xl;
  }

  .article-meta {
    @apply text-muted-foreground;
  }

  .article-content {
    @apply max-w-none;
  }

  /* Custom prose-like styles for article content */
  .article-content h1 {
    @apply text-3xl font-bold tracking-tight mt-8 mb-4;
  }

  .article-content h2 {
    @apply text-2xl font-semibold tracking-tight mt-8 mb-4 border-b border-border pb-2;
  }

  .article-content h3 {
    @apply text-xl font-semibold mt-6 mb-3;
  }

  .article-content h4 {
    @apply text-lg font-semibold mt-4 mb-2;
  }

  .article-content p {
    @apply leading-7 mb-4;
  }

  .article-content a {
    @apply text-foreground underline underline-offset-4 hover:text-muted-foreground;
  }

  .article-content strong {
    @apply font-semibold;
  }

  .article-content ul {
    @apply my-4 ml-6 list-disc;
  }

  .article-content ol {
    @apply my-4 ml-6 list-decimal;
  }

  .article-content li {
    @apply mt-2;
  }

  .article-content blockquote {
    @apply mt-4 border-l-4 border-border pl-4 italic text-muted-foreground;
  }

  .article-content code {
    @apply relative bg-muted px-1.5 py-0.5 font-mono text-sm rounded;
  }

  .article-content pre {
    @apply my-4 overflow-x-auto bg-muted p-4 rounded-lg;
  }

  .article-content pre code {
    @apply bg-transparent p-0 rounded-none;
  }

  .article-content hr {
    @apply my-8 border-border;
  }

  .article-content img {
    @apply my-4;
  }

  .article-content table {
    @apply my-4 w-full;
  }

  .article-content th {
    @apply border border-border px-4 py-2 text-left font-semibold;
  }

  .article-content td {
    @apply border border-border px-4 py-2;
  }
}

@layer utilities {
  /* ===== PROGRESS BAR ===== */
  .progress-bar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    z-index: 9999;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .progress-bar.active {
    opacity: 1;
  }

  .progress-bar-inner {
    width: 100%;
    height: 100%;
    background: var(--color-muted-foreground);
    opacity: 0.4;
    transform: translateX(-100%);
    transition: transform 0.2s ease-out;
  }

  /* ===== SCREEN READER ONLY ===== */
  /* Visually hidden but accessible to screen readers */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* ===== REDUCED MOTION SUPPORT ===== */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* HTMX loading indicator */
  .htmx-indicator {
    display: none;
  }
  .htmx-request .htmx-indicator {
    display: inline-block;
  }
  .htmx-request.htmx-indicator {
    display: inline-block;
  }

  /* Hide elements during HTMX request */
  .htmx-request .htmx-hide-on-request {
    display: none;
  }

  /* Pulse animation for skeleton loaders */
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  /* Spin animation for loading spinners */
  .animate-spin {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* Loading state for main content during HTMX request */
  #main-content.htmx-request > * {
    opacity: 0.6;
    transition: opacity 0.2s ease;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Text balance for headings */
  .text-balance {
    text-wrap: balance;
  }

  /* Prose-like content width */
  .prose-width {
    max-width: 65ch;
  }

  /* Scrollable area */
  .scrollable-area {
    @apply overflow-y-auto;
    scrollbar-width: thin;
    scrollbar-color: var(--color-border) transparent;
  }

  .scrollable-area::-webkit-scrollbar {
    width: 8px;
  }

  .scrollable-area::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollable-area::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
  }

  /* ===== INLINE EDIT FEEDBACK ===== */
  /* Success flash - checkmark that appears and fades */
  .save-success {
    position: relative;
  }

  .save-success::after {
    content: "âœ“";
    position: absolute;
    top: 50%;
    right: -1rem;
    transform: translateY(-50%);
    font-size: 0.75rem;
    font-weight: 600;
    color: rgb(34 197 94);
    animation: checkmark-fade 1s ease-out forwards;
  }

  @keyframes checkmark-fade {
    0% {
      opacity: 1;
    }
    70% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }

  /* ===== TOAST NOTIFICATIONS (ec-toast-container Web Component) ===== */
  ec-toast-container {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    z-index: 50;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    pointer-events: none;
  }

  ec-toast-container .toast {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    background: var(--color-card);
    color: var(--color-card-foreground);
    border: 1px solid hsl(220 15% 88% / 0.5);
    border-radius: 0.375rem;
    box-shadow: var(--shadow-lg);
    font-size: 0.75rem;
    cursor: pointer;
    pointer-events: auto;
    animation: toast-enter 0.2s ease-out;
  }

  /* Toast type styles */
  ec-toast-container .toast-error {
    border-left: 3px solid var(--color-destructive);
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
  ec-toast-container .toast-error .toast-icon {
    color: var(--color-destructive);
  }

  ec-toast-container .toast-success {
    border-left: 3px solid hsl(142 76% 36%);
  }
  ec-toast-container .toast-success .toast-icon {
    color: hsl(142 76% 36%);
  }

  ec-toast-container .toast-warning {
    border-left: 3px solid hsl(38 92% 50%);
  }
  ec-toast-container .toast-warning .toast-icon {
    color: hsl(38 92% 50%);
  }

  ec-toast-container .toast-info {
    border-left: 3px solid hsl(217 91% 60%);
  }
  ec-toast-container .toast-info .toast-icon {
    color: hsl(217 91% 60%);
  }

  ec-toast-container .toast-exit {
    animation: toast-exit 0.2s ease-out forwards;
  }

  @keyframes toast-enter {
    from {
      opacity: 0;
      transform: translateX(1rem);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes toast-exit {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(1rem);
    }
  }

  /* Inline editable elements */
  .inline-editable {
    @apply cursor-pointer hover:bg-muted/50 px-1 -mx-1;
  }

  .inline-edit-input {
    @apply h-6 text-xs px-1 py-0 w-full border border-input bg-background
           focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2;
  }

  /* ===== FORM VALIDATION ERRORS ===== */
  /* Form-level error banner */
  .form-error {
    @apply flex items-center gap-2 p-3 mb-4 text-sm text-destructive bg-destructive/10 border border-destructive/50 rounded-md;
  }

  /* Field-level error state - border only, no focus ring */
  .input-error {
    @apply border-destructive focus-visible:ring-0 focus-visible:ring-offset-0;
  }

  .textarea-error {
    @apply border-destructive focus-visible:ring-0 focus-visible:ring-offset-0;
  }

  .select-error {
    @apply border-destructive focus-visible:ring-0 focus-visible:ring-offset-0;
  }

  /* Form select trigger - match input styling for dropdown in forms */
  .form-select-trigger {
    @apply flex items-center justify-between gap-2 w-full
           h-10 bg-background border border-input px-3 text-sm text-left rounded-md
           hover:bg-muted/30 cursor-pointer
           focus-visible:outline-none focus-visible:ring-2
           focus-visible:ring-primary/20 focus-visible:border-primary;
    transition-property: background-color, border-color;
    transition-duration: var(--duration-normal);
  }

  .form-select-trigger-error {
    @apply border-destructive focus-visible:ring-0 focus-visible:ring-offset-0;
  }

  /* Field error message */
  .field-error {
    @apply text-xs text-destructive mt-1;
  }

  /* Valid field state (for client-side validation feedback) */
  .input-valid {
    @apply border-green-500 focus-visible:ring-green-500;
  }

  /* ===== TAG SELECT COMPONENT (ec-tag-select Web Component) ===== */
  ec-tag-select {
    @apply relative block;
  }

  ec-tag-select [data-trigger] {
    @apply flex flex-wrap items-center gap-1.5 min-h-10 w-full border border-input bg-background px-3 py-2 text-sm rounded-md
           cursor-pointer hover:bg-muted/30;
    transition-property: background-color, border-color;
    transition-duration: var(--duration-normal);
  }

  ec-tag-select [data-chips] {
    @apply flex flex-wrap gap-1;
  }

  ec-tag-select [data-placeholder] {
    @apply text-muted-foreground/60;
  }

  ec-tag-select [data-placeholder]:empty {
    @apply hidden;
  }

  ec-tag-select [data-trigger] > svg {
    @apply ml-auto shrink-0 text-muted-foreground;
  }

  .tag-chip {
    @apply inline-flex items-center gap-1 bg-primary/10 text-primary text-xs px-2 py-0.5 rounded-full;
  }

  .tag-chip-remove {
    @apply hover:text-destructive cursor-pointer;
    transition-property: color;
    transition-duration: var(--duration-fast);
  }

  ec-tag-select [data-dropdown] {
    @apply absolute top-full left-0 right-0 mt-1 z-50
           bg-card border border-border/50 max-h-60 overflow-hidden rounded-md;
    box-shadow: var(--shadow-lg);
  }

  ec-tag-select [data-dropdown] > div:first-child {
    @apply border-b border-border/50;
  }

  ec-tag-select [data-filter] {
    @apply w-full px-3 py-2 text-sm bg-transparent outline-none
           placeholder:text-muted-foreground/60;
  }

  ec-tag-select [data-options] {
    @apply max-h-40 overflow-y-auto;
  }

  ec-tag-select [data-option] {
    @apply flex items-center gap-2 px-3 py-1.5 text-sm cursor-pointer hover:bg-muted/50;
    transition-property: background-color;
    transition-duration: var(--duration-fast);
  }

  ec-tag-select [data-option][hidden] {
    @apply hidden;
  }

  ec-tag-select [data-option] input[type="checkbox"] {
    @apply h-4 w-4 border-input rounded;
  }

  ec-tag-select [data-create] {
    @apply border-t border-border/50;
  }

  ec-tag-select [data-create-btn] {
    @apply flex items-center gap-2 w-full px-3 py-2 text-sm text-primary hover:bg-muted/50 cursor-pointer;
    transition-property: background-color;
    transition-duration: var(--duration-fast);
  }

  /* ===== DRAWER COMPONENT (ec-drawer Web Component) ===== */
  ec-drawer {
    display: contents; /* Don't affect layout */
  }

  ec-drawer [data-backdrop] {
    @apply fixed inset-0 z-40 bg-black/50;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 200ms ease-out,
      visibility 200ms ease-out;
  }

  ec-drawer [data-backdrop].open {
    opacity: 1;
    visibility: visible;
  }

  ec-drawer [data-panel] {
    @apply fixed top-0 right-0 z-50 h-full w-[600px] max-w-full
           bg-background border-l border-border/50
           flex flex-col;
    box-shadow: var(--shadow-lg);
    transform: translateX(100%);
    transition: transform 200ms ease-out;
    overscroll-behavior: contain;
  }

  ec-drawer [data-panel].open {
    transform: translateX(0);
  }

  ec-drawer [data-header] {
    @apply flex items-center justify-between px-6 py-4 border-b border-border/50;
  }

  ec-drawer [data-title] {
    @apply text-lg font-semibold text-foreground;
  }

  ec-drawer [data-close] {
    @apply p-1.5 text-muted-foreground hover:text-foreground hover:bg-muted/50 rounded-md;
    transition-property: background-color, color;
    transition-duration: var(--duration-normal);
  }

  ec-drawer [data-content] {
    @apply flex-1 overflow-y-auto;
  }

  /* Drawer form styling (used inside loaded content) */
  .drawer-form {
    @apply p-6 space-y-6;
  }

  .drawer-form-actions {
    @apply sticky bottom-0 flex items-center gap-3 px-6 py-4 bg-background border-t border-border;
  }

  /* ===== THEME TOGGLE ===== */
  .theme-toggle-group {
    @apply flex gap-0.5 p-1 bg-muted/50 rounded-lg;
  }

  .mode-btn {
    @apply flex-1 flex items-center justify-center px-2 py-1.5 text-sm cursor-pointer text-muted-foreground rounded-md hover:text-foreground;
    transition-property: background-color, color, box-shadow;
    transition-duration: var(--duration-normal);
  }

  .mode-btn-active {
    @apply bg-background text-foreground;
    box-shadow: var(--shadow-sm);
  }

  /* ===== KANBAN BOARD ===== */
  .kanban-board-wrapper {
    @apply relative flex-1 min-h-0 overflow-hidden;
  }

  .kanban-board {
    @apply flex gap-4 overflow-x-auto overflow-y-hidden h-full;
  }

  .kanban-column {
    @apply flex flex-col bg-muted/30 border border-border/50 shrink-0 rounded-lg;
    width: 280px;
    max-height: 100%;
  }

  .kanban-column-header {
    @apply sticky top-0 z-10 flex items-center justify-between gap-2 px-3 py-2 bg-card border-b border-border/50 rounded-t-lg;
  }

  .kanban-column-title {
    @apply flex items-center gap-2 min-w-0;
  }

  .kanban-column-title h3 {
    @apply text-sm font-semibold text-foreground truncate;
  }

  .kanban-column-count {
    @apply text-xs text-muted-foreground shrink-0;
  }

  .kanban-column-actions {
    @apply flex items-center gap-1 shrink-0;
  }

  .kanban-column-content {
    @apply flex-1 overflow-y-auto p-2 space-y-2 min-h-0;
    scrollbar-width: thin;
    scrollbar-color: var(--color-border) transparent;
  }

  .kanban-column-content::-webkit-scrollbar {
    width: 6px;
  }

  .kanban-column-content::-webkit-scrollbar-track {
    background: transparent;
  }

  .kanban-column-content::-webkit-scrollbar-thumb {
    background-color: var(--color-border);
  }

  .kanban-column-footer {
    @apply sticky bottom-0 p-2 bg-card border-t border-border;
  }

  /* Kanban Card */
  .kanban-card {
    @apply flex items-start gap-2 p-2 bg-card border border-border/50 cursor-grab rounded-md;
    transition:
      box-shadow var(--duration-normal) ease,
      transform var(--duration-normal) ease;
  }

  .kanban-card:hover {
    box-shadow: var(--shadow-md);
  }

  .kanban-card:active {
    cursor: grabbing;
  }

  .kanban-card-drag-handle {
    @apply shrink-0 text-muted-foreground/50 cursor-grab mt-0.5;
  }

  .kanban-card-drag-handle:hover {
    @apply text-muted-foreground;
  }

  .kanban-card-content {
    @apply flex-1 min-w-0;
  }

  .kanban-card-title {
    @apply text-xs font-medium text-foreground truncate;
  }

  .kanban-card-meta {
    @apply flex items-center gap-1.5 mt-1 text-[10px] text-muted-foreground;
  }

  .kanban-card-domain {
    @apply truncate;
  }

  .kanban-card-badges {
    @apply flex items-center gap-1 shrink-0;
  }

  .kanban-card-actions {
    @apply shrink-0 opacity-0;
    transition: opacity 0.1s ease;
  }

  .kanban-card:hover .kanban-card-actions,
  .kanban-card:focus .kanban-card-actions,
  .kanban-card:focus-within .kanban-card-actions {
    @apply opacity-100;
  }

  /* Focus ring for keyboard navigation */
  .kanban-card:focus-visible {
    @apply outline-none ring-2 ring-ring ring-offset-2 ring-offset-background;
  }

  /* Keyboard drag mode - card being moved via keyboard */
  .kanban-card.keyboard-dragging {
    @apply ring-2 ring-primary ring-offset-2 ring-offset-background;
    transform: scale(1.02);
    box-shadow: var(--shadow-lg);
  }

  /* Visual indicator for drop target column during keyboard drag */
  .kanban-column-content.keyboard-drop-target {
    @apply bg-primary/10;
    box-shadow: inset 0 0 0 2px hsl(var(--primary) / 0.3);
  }

  /* Kanban card dropdown - specific styles for icon-trigger dropdowns */
  ec-dropdown .kanban-dropdown-menu {
    width: 140px !important;
  }

  ec-dropdown .kanban-dropdown-option {
    @apply flex items-center gap-2;
  }

  /* Selected state for multi-select */
  .kanban-card.selected {
    @apply ring-2 ring-primary/60 bg-primary/5;
  }

  .kanban-card.selected:focus {
    @apply ring-2 ring-primary;
  }

  /* Native drag states */
  .kanban-card.dragging {
    @apply opacity-50;
  }

  /* Multi-drag: hide secondary dragged cards */
  .kanban-card.multi-drag-secondary {
    @apply hidden;
  }

  /* Multi-drag badge showing count */
  .multi-drag-badge {
    @apply absolute -top-2 -right-2 z-10;
    @apply w-6 h-6 flex items-center justify-center;
    @apply bg-primary text-primary-foreground;
    @apply text-xs font-semibold rounded-full;
    @apply shadow-md;
  }

  /* Drop position indicator - line/bar */
  .kanban-drop-placeholder {
    @apply h-1 bg-primary my-1;
  }

  /* Column receiving drop */
  .kanban-column-content.drag-over {
    @apply bg-primary/5;
  }

  /* Empty column state */
  .kanban-empty {
    @apply flex flex-col items-center justify-center py-8 text-center;
  }

  .kanban-empty-text {
    @apply text-xs text-muted-foreground;
  }

  /* New collection column */
  .kanban-new-column {
    @apply flex items-center justify-center border-dashed cursor-pointer;
    transition:
      background-color 0.15s ease,
      border-color 0.15s ease;
  }

  .kanban-new-column:hover {
    @apply bg-muted/50 border-primary/50;
  }

  .kanban-new-column-content {
    @apply flex flex-col items-center gap-2 text-muted-foreground;
    transition: color 0.15s ease;
  }

  .kanban-new-column:hover .kanban-new-column-content {
    @apply text-primary;
  }

  /* Add bookmark button */
  .kanban-add-btn {
    @apply w-full flex items-center justify-center gap-1 py-1.5 text-xs text-muted-foreground
           hover:text-foreground hover:bg-muted;
    transition:
      background-color 0.15s ease,
      color 0.15s ease;
  }

  /* Focus state for cards (navigation without grab) */
  .kanban-card:focus {
    @apply outline-none ring-2 ring-primary/50 ring-offset-1 ring-offset-background;
  }

  /* Keyboard shortcuts help trigger button */
  .kanban-help-trigger {
    @apply fixed bottom-4 right-4 z-30 flex items-center justify-center
           w-8 h-8 bg-card hover:bg-muted/50 border border-border/50 rounded-md
           text-muted-foreground hover:text-foreground cursor-pointer;
    box-shadow: var(--shadow-md);
    transition:
      background-color var(--duration-normal) ease,
      color var(--duration-normal) ease;
  }

  .kanban-help-trigger kbd {
    @apply text-xs font-mono;
  }

  /* ============================================
     KEYBOARD HELP MODAL
     ============================================ */

  .kanban-help-modal {
    @apply fixed inset-0 z-50 flex items-center justify-center;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
  }

  .kanban-help-modal.hidden {
    @apply hidden;
  }

  .kanban-help-content {
    @apply bg-card border border-border/50 shadow-xl max-w-lg w-full mx-4 max-h-[80vh] overflow-hidden flex flex-col rounded-lg;
  }

  .kanban-help-header {
    @apply flex items-center justify-between px-4 py-3 border-b border-border/50;
  }

  .kanban-help-title {
    @apply text-base font-semibold;
  }

  .kanban-help-close {
    @apply p-1 text-muted-foreground hover:text-foreground hover:bg-muted;
    transition:
      background-color 0.15s ease,
      color 0.15s ease;
  }

  .kanban-help-body {
    @apply px-4 py-3 overflow-y-auto space-y-4;
  }

  .kanban-help-section {
    @apply space-y-2;
  }

  .kanban-help-section-title {
    @apply text-xs font-semibold text-muted-foreground uppercase tracking-wider;
  }

  .kanban-help-list {
    @apply space-y-1;
  }

  .kanban-help-item {
    @apply flex items-center justify-between gap-4 py-1;
  }

  .kanban-help-keys {
    @apply flex items-center gap-1 flex-shrink-0;
  }

  .kanban-help-keys kbd {
    @apply inline-flex items-center justify-center min-w-[1.5rem] h-6 px-1.5
           bg-muted border border-border text-xs font-mono;
  }

  .kanban-help-desc {
    @apply text-sm text-muted-foreground;
  }

  /* ============================================
     SELECTION TOOLBAR
     ============================================ */

  .kanban-selection-toolbar {
    @apply fixed bottom-4 left-1/2 -translate-x-1/2 z-40;
    @apply flex items-center gap-3 px-4 py-2;
    @apply bg-card border border-border/50 rounded-lg;
    box-shadow: var(--shadow-lg);
    animation: toolbar-slide-up 0.2s ease-out;
  }

  .kanban-selection-toolbar.hidden {
    @apply hidden;
  }

  @keyframes toolbar-slide-up {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(1rem);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  .selection-count {
    @apply text-sm font-medium text-foreground whitespace-nowrap;
  }

  .selection-toolbar-divider {
    @apply h-5 w-px bg-border;
  }

  .selection-toolbar-actions {
    @apply flex items-center gap-2;
  }

  .selection-toolbar-btn {
    @apply flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-md;
    @apply bg-muted/50 hover:bg-muted text-foreground;
    transition: background-color var(--duration-normal) ease;
  }

  .selection-toolbar-btn-destructive {
    @apply bg-destructive/10 hover:bg-destructive/20 text-destructive;
  }

  .selection-toolbar-close {
    @apply p-1 text-muted-foreground hover:text-foreground hover:bg-muted/50 rounded-md;
    transition:
      background-color var(--duration-normal) ease,
      color var(--duration-normal) ease;
  }

  /* Move dropdown in selection toolbar */
  .selection-move-dropdown {
    @apply relative;
  }

  .selection-move-menu {
    @apply absolute bottom-full left-0 mb-2 w-48;
    @apply bg-card border border-border;
    box-shadow: var(--shadow-md);
    display: none;
  }

  .selection-move-menu.open {
    display: block;
  }

  .selection-move-option {
    @apply flex items-center gap-2 w-full px-3 py-2 text-sm text-left;
    @apply hover:bg-muted cursor-pointer;
  }

  .selection-move-option-color {
    @apply w-3 h-3 shrink-0;
  }

  /* ============================================
     KEYBOARD MOVE MENU
     ============================================ */

  .kanban-move-menu-backdrop {
    @apply fixed inset-0 z-40;
    background: rgba(0, 0, 0, 0.3);
    animation: backdrop-fade-in 0.15s ease-out;
  }

  .kanban-move-menu-backdrop.hidden {
    @apply hidden;
  }

  @keyframes backdrop-fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  .kanban-move-menu {
    @apply fixed z-50;
    @apply flex flex-col;
    @apply bg-card border border-border/50 rounded-lg;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    min-width: 280px;
    max-width: 360px;
    max-height: 400px;
    box-shadow: var(--shadow-lg);
    animation: move-menu-fade-in 0.15s ease-out;
  }

  .kanban-move-menu.hidden {
    @apply hidden;
  }

  @keyframes move-menu-fade-in {
    from {
      opacity: 0;
      transform: translate(-50%, -48%);
    }
    to {
      opacity: 1;
      transform: translate(-50%, -50%);
    }
  }

  .kanban-move-menu-header {
    @apply px-4 py-3 border-b border-border;
    @apply text-sm font-medium text-foreground;
  }

  .kanban-move-menu-list {
    @apply flex-1 overflow-y-auto py-2;
  }

  .kanban-move-menu-item {
    @apply flex items-center gap-3 px-4 py-2;
    @apply text-sm text-foreground cursor-pointer;
    transition: background-color 0.1s ease;
  }

  .kanban-move-menu-item:hover:not(.current) {
    @apply bg-muted;
  }

  .kanban-move-menu-item.focused {
    @apply bg-muted;
    outline: 2px solid hsl(var(--primary));
    outline-offset: -2px;
  }

  .kanban-move-menu-item.current {
    @apply opacity-50 cursor-not-allowed;
  }

  .kanban-move-menu-item.current .kanban-move-menu-item-name::after {
    content: " (current)";
    @apply text-xs text-muted-foreground;
  }

  .kanban-move-menu-item-color {
    @apply w-3 h-3 shrink-0;
  }

  .kanban-move-menu-item-icon {
    @apply w-4 h-4 shrink-0 text-muted-foreground;
  }

  .kanban-move-menu-item-name {
    @apply flex-1 truncate;
  }

  .kanban-move-menu-item-shortcut {
    @apply text-xs text-muted-foreground font-mono;
  }

  .kanban-move-menu-footer {
    @apply px-4 py-2 border-t border-border;
    @apply text-center;
  }

  .kanban-move-menu-hint {
    @apply text-xs text-muted-foreground;
  }

  .kanban-move-menu-hint kbd {
    @apply inline-flex items-center justify-center min-w-[1.25rem] h-5 px-1
           bg-muted border border-border text-xs font-mono mx-0.5;
  }

  .kanban-move-menu-hint-sep {
    @apply mx-1 text-border;
  }
}

/* ===== VIEW TRANSITIONS ===== */
/* Scale-down/pop-up effect for page navigation on mobile */
/* Progressive enhancement - browsers without support simply ignore these rules */

/* Exclude UI elements from view transitions to prevent flickering */
.nav-drawer,
.mobile-bottom-bar,
.nav-loading-indicator,
.mobile-collection-bar {
  view-transition-name: none;
}

/* Mobile: Enable view transitions with scale/bounce effect */
@media (max-width: 1023px) {
  @view-transition {
    navigation: auto;
  }

  /* Scale down and fade out the old page */
  ::view-transition-old(root) {
    animation: vt-scale-down-out 250ms ease-out forwards;
  }

  /* Pop up with subtle bounce for new page */
  ::view-transition-new(root) {
    animation: vt-scale-up-bounce 250ms cubic-bezier(0.34, 1.56, 0.64, 1)
      forwards;
  }

  @keyframes vt-scale-down-out {
    from {
      transform: scale(1);
      opacity: 1;
    }
    to {
      transform: scale(0.94);
      opacity: 0;
    }
  }

  @keyframes vt-scale-up-bounce {
    from {
      transform: scale(0.94);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
}

/* Desktop: Disable view transitions */
@media (min-width: 1024px) {
  ::view-transition-old(root),
  ::view-transition-new(root) {
    animation: none;
  }
}
